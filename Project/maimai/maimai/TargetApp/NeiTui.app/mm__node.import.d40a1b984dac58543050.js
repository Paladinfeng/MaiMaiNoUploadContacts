webpackJsonp([2],{1570:function(e,a,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function i(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}function r(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a)}Object.defineProperty(a,"__esModule",{value:!0});var c,l,s=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},p=function(){function e(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(a,t,n){return t&&e(a.prototype,t),n&&e(a,n),a}}(),d=t(1),u=n(d),f=t(113),_=t(76),y=n(_),m=t(164),h=t(167),w=t(75),b=t(114),v=n(b),g=t(15),k=n(g),x=t(17),E=n(x),N=t(46),P=n(N),M=t(47);a.default=e.exports=(l=c=function(e){function a(){var e,t,n,r;o(this,a);for(var c=arguments.length,l=Array(c),p=0;p<c;p++)l[p]=arguments[p];return t=n=i(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(l))),n.state={auto_renew_checked:!0,alipay_sign_enabled:!0,wxpay_sign_enabled:!0,ref_mobile:""},n.confirmPaySuc=function(e){var a=n.context.auth_info,t=fetch("/sdk/red_packet/check_payed?"+k.default.stringify(s({},a,{orderid:e}))).then(w.parse_online_json).then(function(a){1==a.payed?n.paySuc(e):(0,h.showModalForConfirm)({title:"支付未成功？",ok_text:"确定",ok:function(){(0,m.closePage)("",!0)}})}).catch(function(){(0,h.showModalForConfirm)({title:"网络有问题,请重试？",ok_text:"确定",ok:function(){n.confirmPaySuc(e)}})});(0,v.default)("检查支付结果...",t)},n.checkPayState=function(e,a){n.timeoutid=setTimeout(function(){a&&(0,h.showModalForConfirm)({title:"正在检查支付状态, 是否支付完成?",ok_text:"支付完成",ok:function(){n.timeoutid&&(window.clearTimeout(n.timeoutid),delete n.timeoutid),n.confirmPaySuc(e)},cancel:function(){n.timeoutid&&(window.clearTimeout(n.timeoutid),delete n.timeoutid),(0,m.closePage)("",!0)},cancel_text:"支付遇到问题"});var t=n.context.auth_info;fetch("/sdk/red_packet/check_payed?"+k.default.stringify(s({},t,{orderid:e}))).then(w.parse_online_json).then(function(a){1==a.payed?n.paySuc(e):n.checkPayState(e,!1)}).catch(function(){n.checkPayState(e,!1)})},5e3)},n.paySuc=function(e){var a=n.context.req;n.timeoutid&&(window.clearTimeout(n.timeoutid),delete n.timeoutid),(0,y.default)("支付成功"),(0,f.sendWebViewBroadcast)("broadcast_web_pay_suc",JSON.stringify(s({orderid:e,appid:n.props.order_params.appid,apptype:n.props.apptype,mem_id:a.query.mem_id},n.props.order_params))),n.props.suc_location?(window.MaiMai_Native.native_popview_onbackkey&&window.MaiMai_Native.native_popview_onbackkey(),window.location.replace(n.props.suc_location),window.MaiMai_Native.hide_dialog_bg&&window.MaiMai_Native.hide_dialog_bg()):(0,m.closePage)("",!0)},n.ali_pay_callback=function(e){if(e.indexOf("resultStatus={9000};")>=0||e.indexOf('"resultStatus":"9000"')>=0)n.paySuc(n.aliorderid);else{(0,y.default)("支付失败");var a={orderid:n.aliorderid,pay:n.aliOrderPayInfo,result:e};fetch("/pay/ali_pay_local_failed?"+k.default.stringify(a),{credentials:"same-origin"})}},n.alipaysign_callback=function(e){if(e.indexOf("is_success=T")>=0)n.paySuc(n.aliorderid);else{(0,y.default)("支付失败");var a={orderid:n.aliorderid,pay:n.alipaysign_order_info,result:e};fetch("/pay/ali_pay_local_failed?"+k.default.stringify(a),{credentials:"same-origin"})}},n.wx_web_cb=function(e){console.log(e)},n.alipay=function(){if(n.aliOrderPayInfo)return void window.MaiMai_Native.native_zfb_pay(n.aliOrderPayInfo,"ali_pay_callback");var e=n.context.auth_info,a=fetch(n.props.pay_api+"type=alipay&"+k.default.stringify(n.props.order_params)+"&_csrf="+e._csrf,{credentials:"same-origin"}).then(w.parse_online_json).then(function(e){if(!e.pay)return void(0,y.default)("订单生成失败");n.aliorderid=e.orderid,n.aliOrderPayInfo=e.pay,window.MaiMai_Native.native_zfb_pay(n.aliOrderPayInfo,"ali_pay_callback")}).catch(w.toast_error_handler);(0,v.default)("正在生成订单",a)},n.alipaysign=function(){if(n.alipaysign_order_info)return void window.MaiMai_Native.native_alipay(JSON.stringify({url:n.alipaysign_order_info,callback:"alipaysign_callback"}));var e=n.context.auth_info,a=fetch(n.props.pay_api+"type=alipaysign&"+k.default.stringify(n.props.order_params)+"&_csrf="+e._csrf,{credentials:"same-origin"}).then(w.parse_online_json).then(function(e){if(!e.pay)return void(0,y.default)("订单生成失败");n.aliorderid=e.orderid,n.alipaysign_order_info=e.pay,window.MaiMai_Native.native_alipay(JSON.stringify({url:n.alipaysign_order_info,callback:"alipaysign_callback"}))}).catch(w.toast_error_handler);(0,v.default)("正在生成订单",a)},n.memdealSetAutoRenew=function(e,a){var t=n.context,o=t.auth_info,i=t.fconf,r=i.online_url+"talent/v3/uh/set_memdeal?"+k.default.stringify(s({memdeal_id:n.props.appid,add_auto_renew:e,promo:n.state.ref_mobile},o));fetch(r,{credentials:"same-origin"}).then(w.parse_online_json).then(function(e){return 1==e.ret?(a(),!0):((0,y.default)("自动续费错误1"),!1)}).catch(function(){return(0,y.default)("自动续费错误2"),!1})},n.maimaipay=function(){var e=n.context.auth_info,a=fetch(n.props.pay_api+"type=balance&"+k.default.stringify(n.props.order_params)+"&_csrf="+e._csrf,{credentials:"same-origin"}).then(w.parse_online_json).then(function(e){n.paySuc(e.orderid)}).catch(function(e){(0,h.showModalForConfirm)({title:e,ok_text:"确定"})});(0,v.default)("请求中",a)},n.wxpay=function(){if(n.wxOrderPayInfo)return void window.MaiMai_Native.native_wx_pay(n.wxOrderPayInfo);var e=n.context.auth_info,a=fetch(n.props.pay_api+"type=wxpay&"+k.default.stringify(n.props.order_params)+"&_csrf="+e._csrf,{credentials:"same-origin"}).then(w.parse_online_json).then(function(e){if(!e.pay)return void(0,y.default)("订单生成失败");n.wxorderid=e.orderid,n.wxOrderPayInfo=JSON.stringify(e.pay),n.wxprepayid=e.pay.prepay_id,window.MaiMai_Native.native_wx_pay(n.wxOrderPayInfo),(0,f.bindBroadcast)("WeXin_Pay_Suc",function(e){n.wxorderid&&n.wxprepayid==e&&n.paySuc(n.wxorderid)}),n.checkPayState(e.orderid,!0)}).catch(w.toast_error_handler);(0,v.default)("正在生成订单",a)},n.wxpaysign=function(){if(n.wxpaysign_order_info){var e="https://api.mch.weixin.qq.com/papay/entrustweb?"+k.default.stringify(n.wxpaysign_order_info);return void MaiMai_Native.native_wx_web(e,"wx_web_cb")}var a=n.context.auth_info,t=fetch(n.props.pay_api+"type=wxpaysign&"+k.default.stringify(n.props.order_params)+"&_csrf="+a._csrf,{credentials:"same-origin"}).then(w.parse_online_json).then(function(e){if(!e.pay)return void(0,y.default)("订单生成失败");n.wxorderid=e.orderid,n.wxpaysign_order_info=e.pay;var a="https://api.mch.weixin.qq.com/papay/entrustweb?"+k.default.stringify(n.wxpaysign_order_info);MaiMai_Native.native_wx_web(a,"wx_web_cb"),n.checkPayState(e.orderid,!0)}).catch(w.toast_error_handler);(0,v.default)("正在生成订单",t)},n.bankpay=function(){var e="/contact/account/list_bank_card?type=3&dpvalue="+n.props.actual_cost.toFixed(2);(0,P.default)(e,"银行卡充值","fetch")},n.onPay=E.default.debounce(function(){var e=n.getOptions().selectType;n.getOptions();try{var a=n.context,t=a.auth_info,o=a.fconf,i=n.props,r=i.order_params,c=i.apptype;if(c)var l="pay_"+e+"_"+c;else var l="pay_"+e+"_other";var p=o.online_url+"job/v3/ping_act?"+k.default.stringify(s({act:l,act_id:0,fr:r.orderid},t));fetch(p,{credential:"same-origin"})}catch(e){}n.props.actual_cost<.001||"balance"==e?n.maimaipay():"alipay"==e?1==n.ar&&1!=n.props.pay_uinfo.is_alipay_sign?n.alipaysign():n.alipay():"wxpay"==e?1==n.ar&&1!=n.props.pay_uinfo.is_wxpay_sign?n.wxpaysign():n.wxpay():"bank"==e&&n.bankpay()},2e3,!0),n.submitAndPay=E.default.debounce(function(){var e=n.context.req;if(1==n.state.loading)return void(0,y.default)("订单更新中,请再次点击支付");n.no_click=1,n.props.set_no_click(1),setTimeout(function(){n.no_click=0,n.props.set_no_click(0)},2e5);n.getOptions();"uh_memdeal"==n.props.apptype&&(1!=n.props.to_auto_renew?n.ar=2:n.props.cursor.select("show_auto_renew").get()&&0==e.query.bulk_cnt?n.ar=1:n.ar=0,n.memdealSetAutoRenew(n.ar,n.onPay))},1e3,!0),n.onMethodSelect=function(e){n.getOptions().disable_balance&&"balance"==e?(0,y.default)("余额不足"):(n.setState({selectType:e}),n.forceUpdate())},n.onAutoRenewClick=function(){if(1==n.no_click)return void(0,y.default)("订单正在支付中,如支付失败,请重新进入页面支付");n.state.auto_renew_checked?n.setState({auto_renew_checked:!1,loading:!0}):n.setState({auto_renew_checked:!0,loading:!0}),n.forceUpdate()},n.getOptions=function(){var e=n.context,a=e.req,t=(e.auth_info,{});return t.show_alipay=!n.props.disable_alipay&&!n.props.is_deposit,t.show_alipay&&"defined"==typeof window&&(window.MaiMai_Native.native_zfb_pay||window.MaiMai_Native.native_alipay_v2||(t.show_alipay=!1)),t.show_wxpay=!n.props.disable_weixin,t.show_wxpay&&"defined"==typeof window&&(window.MaiMai_Native.native_wx_pay||(t.show_wxpay=!1)),"uh_memdeal"==n.props.apptype&&4==a.query.mem_id&&(t.show_wxpay=!1),t.show_bank=!!n.props.is_deposit,t.show_balance=1!=n.props.disable_balance&&n.props.balance>0&&!n.props.is_deposit,t.disable_balance=n.props.balance<n.props.actual_cost||n.no_balance,n.props.actual_cost<.001&&(t.show_alipay=!1,t.show_wxpay=!1),n.state.selectType?t.selectType=n.state.selectType:!t.show_balance||t.disable_balance||n.props.is_deposit||n.no_balance?t.show_wxpay?t.selectType="wxpay":t.show_alipay?t.selectType="alipay":t.show_bank&&(t.selectType="bank"):t.selectType="balance","balance"==t.selectType||n.state.selectType||(n.no_balance=!0),t.show_coupon=!n.props.is_deposit&&n.props.order_params.cpid&&n.props.order_params.cpid>0&&n.props.order_params.discount&&n.props.order_params.discount>0,t.show_auto_renew=!1,console.log(n.props.apptype),console.log(n.props.to_auto_renew),"uh_memdeal"==n.props.apptype&&1==n.props.to_auto_renew&&1==a.query.has_bulk&&("alipay"==t.selectType&&n.state.alipay_sign_enabled&&(t.show_auto_renew=!0),"wxpay"==t.selectType&&n.state.wxpay_sign_enabled&&(t.show_auto_renew=!0)),"undefined"!=typeof window&&n.props.cursor.select("show_auto_renew").set(t.show_auto_renew),t.auto_renew_checked=n.state.auto_renew_checked,1!=n.props.to_auto_renew?(t.add_auto_renew=2,n.onAddAutoRenewChanged(t.add_auto_renew)):t.show_auto_renew&&t.auto_renew_checked?(t.add_auto_renew=1,n.onAddAutoRenewChanged(t.add_auto_renew)):(t.add_auto_renew=0,n.onAddAutoRenewChanged(t.add_auto_renew)),t},n.onAddAutoRenewChanged=function(e){return},n.goToSience=function(){window.location.href="http://maimai.cn/html/member/pro_license.html"},n.onRefmobileChange=function(){var e=M.findDOMNode(n.refs.ref_mobile)?M.findDOMNode(n.refs.ref_mobile).value:"";""!=e&&(e=e.trim().toUpperCase().replace(/[^0-9A-Z]/,"")),(""+e).length<=15&&e!=n.state.ref_mobile&&n.setState({ref_mobile:e})},n.resetThis=function(){n.context.req;delete n.aliorderid,delete n.aliOrderPayInfo,delete n.alipaysign_order_info,delete n.wxorderid,delete n.wxprepayid,delete n.wxOrderPayInfo,delete n.wxpaysign_order_info,delete n.reset_this,n.setState({loading:!1})},n.openInvitationPage=function(){var e=n.context,a=e.req;e.auth_info;(0,P.default)("/pay/invitation_code?invc="+a.query.invc,"选择邀请码","fetch")},r=t,i(n,r)}return r(a,e),p(a,[{key:"componentDidMount",value:function(){var e=this,a=this.context.req;window.ali_pay_callback=this.ali_pay_callback,window.alipaysign_callback=this.alipaysign_callback,window.wx_web_cb=this.wx_web_cb,window.MaiMai_Native.native_alipay||(this.setState({alipay_sign_enabled:!1}),this.forceUpdate()),window.MaiMai_Native.native_wx_web||(this.setState({wxpay_sign_enabled:!1}),this.forceUpdate()),a.query.invc&&a.query.invc.length>0&&this.setState({ref_mobile:a.query.invc}),(0,f.bindBroadcast)("getCode",function(a){e.setState({ref_mobile:a.code})})}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this,a=this.context,t=a.req;a.auth_info;this.cnt?this.cnt++:this.cnt=1;var n=this.getOptions(),o="";n.show_coupon&&(o=" (已使用代金券抵扣"+this.props.order_params.discount+"元)"),1==this.reset_this&&this.resetThis();var i,r,c,l,s,p;this.props.is_deposit?(r="微信充值",c="支付宝充值",l="银行卡充值",i="充值金额"):(r="微信支付",c="支付宝支付",l="银行卡支付",i="需支付"),"chatgift"==this.props.tpl?(p=u.default.createElement("div",{className:"payBtn2",onClick:this.onPay},u.default.createElement("a",{href:"javascript:void(0)"},"支付并发送消息")),s="payPanel mBottom"):this.props.is_deposit?(p=u.default.createElement("div",{className:"payBtn",onClick:this.onPay},u.default.createElement("a",{href:"javascript:void(0)"},"立即充值")),s="payPanel"):"uh_memdeal"==this.props.apptype?(p=u.default.createElement("div",{className:"payBtn_fixed",onClick:this.submitAndPay},u.default.createElement("a",{href:"javascript:void(0)"},"立即支付")),s="payPanel payPanelMemdeal"):(p=u.default.createElement("div",{className:"payBtn",onClick:this.onPay},u.default.createElement("a",{href:"javascript:void(0)"},"立即支付")),s="payPanel");var d="";if("uh_memdeal"==this.props.apptype&&this.props.bulk.invite_addfr[t.query.mem_id]){var f=this.state.ref_mobile,_=f||"可额外获得"+this.props.bulk.invite_addfr[t.query.mem_id]+"个加好友名额";d=u.default.createElement("div",{className:"white-bg m-t-10 p-x p-y-23 clearfix",onClick:this.openInvitationPage},u.default.createElement("div",{className:"font-16 fl p-relative"},"选择朋友的邀请码"),u.default.createElement("div",{className:"fr clearfix l-h-22"},u.default.createElement("div",{className:"font-13 text-gray-bc fl"},_),u.default.createElement("div",{className:"arrow_light fr m-l-5 m-t-2"})))}return u.default.createElement("div",{className:s},!1,u.default.createElement("div",{className:"payTitle clearfix "},u.default.createElement("p",{className:"fl font-13"},i,u.default.createElement("em",{style:{color:"#f19838",fontStyle:"normal"}},this.props.actual_cost.toFixed(2)+"元"),o)),n.show_balance&&u.default.createElement("div",{className:n.disable_balance?"payDisableBox":"payBox",onClick:function(){return e.onMethodSelect("balance")}},u.default.createElement("dl",{className:("balance"==n.selectType?"checked":"nocheck")+" pays clearfix"},u.default.createElement("dt",null,u.default.createElement("img",{src:"/static/images/maiPay.png"})),u.default.createElement("dd",{className:"payWayName"},"使用个人账户余额支付"),u.default.createElement("dd",null,"当前余额："+this.props.balance+"元"))),n.show_wxpay&&u.default.createElement("div",{className:"payBox",onClick:function(){return e.onMethodSelect("wxpay")}},u.default.createElement("dl",{className:"pays clearfix"+("wxpay"==n.selectType?" checked":" nocheck")},u.default.createElement("dt",null,u.default.createElement("img",{src:"/static/images/weixinlogo.png"})),u.default.createElement("dd",{className:"payWayName payWayName_center"},r))),n.show_alipay&&u.default.createElement("div",{className:"payBox",onClick:function(){return e.onMethodSelect("alipay")}},u.default.createElement("dl",{className:"pays clearfix"+("alipay"==n.selectType?" checked":" nocheck")},u.default.createElement("dt",null,u.default.createElement("img",{src:"/static/images/alipay.png"})),u.default.createElement("dd",{className:"payWayName payWayName_center"},c))),n.show_bank&&u.default.createElement("div",{className:"payBox",onClick:function(){return e.onMethodSelect("bank")}},u.default.createElement("dl",{className:"pays clearfix"+("bank"==n.selectType?" checked":" nocheck")},u.default.createElement("dt",null,u.default.createElement("img",{src:"/static/images/unionpay.png"})),u.default.createElement("dd",{className:"payWayName payWayName_center"},l))),n.show_auto_renew&&u.default.createElement("div",{style:{height:"15px"}}),1!=t.query.has_bulk&&n.show_auto_renew&&u.default.createElement("div",{className:"payBox",onClick:function(){return e.onAutoRenewClick()}},u.default.createElement("dl",{className:"pays clearfix"+(n.auto_renew_checked?" checked":" nocheck")},u.default.createElement("dd",{className:"payWayName payWayName_center",style:{marginLeft:"0"}},"开通连续包月服务"))),d,"uh_memdeal"==this.props.apptype&&u.default.createElement("div",{className:"pro_license"},"成为会员即表示同意",u.default.createElement("a",{href:"javascript:;",onClick:this.goToSience},"《脉脉会员协议》")),p)}}]),a}(u.default.Component),c.contextTypes={auth_info:u.default.PropTypes.object,fconf:u.default.PropTypes.object,req:u.default.PropTypes.object},l)},1571:function(e,a,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function i(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}function r(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a)}Object.defineProperty(a,"__esModule",{value:!0});var c,l,s=function(){function e(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(a,t,n){return t&&e(a.prototype,t),n&&e(a,n),a}}(),p=t(1),d=n(p),u=t(113),f=t(76),_=n(f),y=t(164),m=t(167),h=t(75),w=t(114),b=n(w),v=t(15),g=n(v),k=t(17),x=n(k);a.default=e.exports=(l=c=function(e){function a(){var e,t,n,r;o(this,a);for(var c=arguments.length,l=Array(c),s=0;s<c;s++)l[s]=arguments[s];return t=n=i(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(l))),n.state={},n.paySuc=function(e){(0,_.default)("支付成功"),(0,u.sendWebViewBroadcast)("broadcast_web_pay_suc",JSON.stringify({orderid:e})),n.props.suc_location?(window.MaiMai_Native.native_popview_onbackkey&&window.MaiMai_Native.native_popview_onbackkey(),window.location.replace(n.props.suc_location)):(0,y.closePage)("",!0)},n.ali_pay_callback=function(e){if(e.indexOf("resultStatus={9000};")>=0||e.indexOf('"resultStatus":"9000"')>=0)n.paySuc(n.aliorderid);else{(0,_.default)("支付失败");var a={orderid:n.aliorderid,pay:n.aliOrderPayInfo,result:e};fetch("/pay/ali_pay_local_failed?"+g.default.stringify(a),{credentials:"same-origin"})}},n.alipay=function(){if(n.aliOrderPayInfo)return void window.MaiMai_Native.native_zfb_pay(n.aliOrderPayInfo,"ali_pay_callback");var e=n.context.auth_info,a=fetch(n.props.pay_api+"type=alipay&"+g.default.stringify(n.props.order_params)+"&_csrf="+e._csrf,{credentials:"same-origin"}).then(h.parse_online_json).then(function(e){if(!e.pay)return void(0,_.default)("订单生成失败");n.aliorderid=e.orderid,n.aliOrderPayInfo=e.pay,window.MaiMai_Native.native_zfb_pay(n.aliOrderPayInfo,"ali_pay_callback")}).catch(toast_error_handler);(0,b.default)("正在生成订单",a)},n.maimaipay=function(){var e=n.context.auth_info,a=fetch(n.props.pay_api+"type=balance&"+g.default.stringify(n.props.order_params)+"&_csrf="+e._csrf,{credentials:"same-origin"}).then(h.parse_online_json).then(function(e){n.paySuc(e.orderid)}).catch(function(e){(0,m.showModalForConfirm)({title:e,ok_text:"确定"})});(0,b.default)("请求中",a)},n.wxpay=function(){if(n.wxOrderPayInfo)return void window.MaiMai_Native.native_wx_pay(n.wxOrderPayInfo);var e=n.context.auth_info,a=fetch(n.props.pay_api+"type=wxpay&"+g.default.stringify(n.props.order_params)+"&_csrf="+e._csrf,{credentials:"same-origin"}).then(h.parse_online_json).then(function(e){if(!e.pay)return void(0,_.default)("订单生成失败");n.wxorderid=e.orderid,n.wxOrderPayInfo=JSON.stringify(e.pay),n.wxprepayid=e.pay.prepay_id,window.MaiMai_Native.native_wx_pay(n.wxOrderPayInfo),(0,u.bindBroadcast)("WeXin_Pay_Suc",function(e){n.wxorderid&&n.wxprepayid==e&&n.paySuc(n.wxorderid)})});(0,b.default)("正在生成订单",a)},n.onPay=x.default.debounce(function(){var e=n.getOptions().selectType;n.props.actual_cost<.001||"balance"==e?n.maimaipay():"alipay"==e?n.alipay():"wxpay"==e&&n.wxpay()},2e3,!0),n.onMethodSelect=function(e){n.setState({selectType:e}),n.forceUpdate()},n.getOptions=function(){var e={};return e.show_alipay=!n.props.disable_alipay,"defined"==typeof window&&(window.MaiMai_Native.native_zfb_pay||window.MaiMai_Native.native_alipay_v2||(e.show_alipay=!1)),e.show_wxpay=!0,"defined"==typeof window&&(window.MaiMai_Native.native_wx_pay||(e.show_wxpay=!1)),e.show_balance=1!=n.props.disable_balance&&n.props.balance>0,e.disable_balance=n.props.balance<n.props.actual_cost,n.state.selectType?e.selectType=n.state.selectType:e.show_balance&&!e.disable_balance?e.selectType="balance":e.show_wxpay?e.selectType="wxpay":e.show_alipay&&(e.selectType="alipay"),n.props.actual_cost<.001&&(e.show_alipay=!1,e.show_wxpay=!1),e.show_coupon=n.props.order_params.cpid&&n.props.order_params.cpid>0&&n.props.order_params.discount&&n.props.order_params.discount>0,e},r=t,i(n,r)}return r(a,e),s(a,[{key:"componentDidMount",value:function(){window.ali_pay_callback=this.ali_pay_callback}},{key:"render",value:function(){var e=this,a=this.getOptions(),t="";return a.show_coupon&&(t=" (已使用代金券抵扣"+this.props.order_params.discount+"元)"),d.default.createElement("div",{className:"payPanel mBottom"},d.default.createElement("div",{className:"payTitle clearfix"},d.default.createElement("p",null,"需支付"+this.props.actual_cost.toFixed(2)+"元"+t)),a.show_balance&&d.default.createElement("div",{className:a.disable_balance?"payDisableBox":"payBox",onClick:function(){return e.onMethodSelect("balance")}},d.default.createElement("dl",{className:("balance"==a.selectType?"checked":"nocheck")+" pays clearfix"},d.default.createElement("dt",null,d.default.createElement("img",{src:"/static/images/maiPay.png"})),d.default.createElement("dd",{className:"payWayName"},"使用个人账户余额支付"),d.default.createElement("dd",null,"当前余额："+this.props.balance+"元"))),a.show_wxpay&&d.default.createElement("div",{className:"payBox",onClick:function(){return e.onMethodSelect("wxpay")}},d.default.createElement("dl",{className:"pays clearfix"+("wxpay"==a.selectType?" checked":" nocheck")},d.default.createElement("dt",null,d.default.createElement("img",{src:"/static/images/weixinlogo.png"})),d.default.createElement("dd",{className:"payWayName payWayName_center"},"微信支付"))),a.show_alipay&&d.default.createElement("div",{className:"payBox",onClick:function(){return e.onMethodSelect("alipay")}},d.default.createElement("dl",{className:"pays clearfix"+("alipay"==a.selectType?" checked":" nocheck")},d.default.createElement("dt",null,d.default.createElement("img",{src:"/static/images/alipay.png"})),d.default.createElement("dd",{className:"payWayName payWayName_center"},"支付宝支付"))),d.default.createElement("div",{className:"payBtn2",onClick:this.onPay},d.default.createElement("a",{href:"javascript:void(0)"},"支付并发送消息")))}}]),a}(d.default.Component),c.contextTypes={auth_info:d.default.PropTypes.object},l)},1572:function(e,a,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},i=t(989),r=n(i),c=t(46),l=n(c),s=t(15),p=n(s),d=t(75),u=n(d),f=t(113),_=t(1),y=_.createClass({displayName:"SendMoney",contextTypes:{auth_info:_.PropTypes.object,req:_.PropTypes.object,fconf:_.PropTypes.object},getInitialState:function(){return{coupon:null,coupon_loading:1}},componentDidMount:function(){document.body.style.backgroundColor="#f6f6f6",(0,f.bindBroadcast)("coupon_selected",this.onCouponSelected),this.getCoupons()},goCoupons:function(){(0,l.default)("/contact/account/list_coupons?type=0&value="+this.props.cost,"查看页面","fetch")},getCoupons:function(){var e=this,a=this.context,t=a.auth_info,n=a.fconf,i=n.online_url+"mmpay/v4/coupons?"+p.default.stringify(o({value:this.props.cost,tp:0},t));fetch(i,{credentials:"same-origin"}).then(u.default.parse_online_json).then(function(a){a.usable&&a.usable>0?e.onCouponSelected(a.coupons[0]):e.setState({coupon_loading:0})}).catch(u.default.toast_error_handler)},onCouponSelected:function(e){this.setState({coupon:e,coupon_loading:0}),this.props.onSelectCoupon(e)},render:function(){var e=this.context,a=(e.auth_info,e.req),t="暂无可用优惠券",n="";if(1==this.state.coupon_loading)t="正在加载可用代金券..";else if(this.state.coupon)t="使用优惠券",n="可抵扣"+this.state.coupon.discount+"元";else var t="暂无可用优惠券",n="";var o="",i=_.createElement("li",{className:"contactFive2"},this.props.cost+"元心意，24小时未回应自动退还"),c="";return a.query.ni&&1==a.query.ni&&(i=_.createElement("li",{className:"contactFive2"},"支付后立即送达"),c=_.createElement("li",{className:"contactFive2"},"24小时未回应全额退还")),o=_.createElement("ul",{className:"payheader2"},_.createElement("li",{className:"safeguards"},_.createElement("img",{src:"/static/images/icon_baoz.png?v=1"})),i,c),_.createElement("div",{className:"moneyBG"},o,_.createElement("div",{className:"moneyFrame clearfix"},_.createElement("ul",{className:"list-group m-b-0"},_.createElement(r.default,{title:t,content:n,onClick:this.goCoupons,showRemind:!0}))))}});e.exports=y},33:function(e,a,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function i(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}function r(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a)}Object.defineProperty(a,"__esModule",{value:!0});var c,l,s=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},p=function(){function e(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(a,t,n){return t&&e(a.prototype,t),n&&e(a,n),a}}(),d=t(1),u=n(d),f=t(1570),_=n(f),y=t(1571),m=(n(y),t(981)),h=n(m),w=t(1572),b=n(w),v=t(75),g=t(76),k=n(g),x=t(114),E=n(x),N=t(274),P=(n(N),t(46)),M=(n(P),t(17)),O=t(15);a.default=e.exports=(l=c=function(e){function a(){var e,t,n,r;o(this,a);for(var c=arguments.length,l=Array(c),p=0;p<c;p++)l[p]=arguments[p];return t=n=i(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(l))),n.onSelectCoupon=function(e){n.props.cursor.select("order_params").merge({cpid:e.id,discount:e.discount}),n.props.cursor.select("actual_cost").set(n.props.cost-e.discount)},n.onSelectBulk=function(e,a,t){var o=n.context,i=o.req,r=o.fconf,c=o.auth_info;if(1==n.no_click)return void(0,k.default)("订单正在支付中,如支付失败,请重新进入页面支付");var l;l=1!=n.props.to_auto_renew?2:n.props.cursor.select("show_auto_renew").get()&&0==a?1:0;var p=r.online_url+"talent/v3/uh/set_memdeal?"+O.stringify(s({memdeal_id:n.props.appid,add_auto_renew:l},c)),d=fetch(p,{credentials:"same-origin"}).then(v.parse_online_json).then(function(e){var o=r.online_url+"talent/v3/uh/set_memdeal_bulk?"+O.stringify(s({memdeal_id:n.props.appid,cnt:a>0?a:1},c));fetch(o,{credentials:"same-origin"}).then(v.parse_online_json).then(function(e){if(1==e.ret){var o=M.extend(i.query,{cost:e.cost,bulk_cnt:a,show_auto_renew:n.props.cursor.select("show_auto_renew").get()?1:0,jsononly:1});t?o.bulk_cnt_choose=a:delete o.bulk_cnt_choose;var r="/pay/pay_uh_memdeal?"+O.stringify(o);fetch(r,{credentials:"same-origin"}).then(v.parse_online_json).then(function(e){n.props.cursor.set(M.extend(e.data,{reset_this:!0}))}).catch(function(e){alert(e)})}else(0,k.default)("网络错误")}).catch(function(e){alert(e)})}).catch(function(e){return(0,k.default)("自动续费错误4"),!1});(0,E.default)("更新中",d)},n.set_no_click=function(e){n.no_click=e},n.set_show_auto_renew=function(e){"undefined"!=typeof alert&&n.props.cursor.select("show_auto_renew").set(e)},r=t,i(n,r)}return r(a,e),p(a,[{key:"componentDidMount",value:function(){var e=this.context;e.req,e.auth_info}},{key:"render",value:function(){var e,a=this,t=this.context,n=t.req,o=(t.auth_info,null);void 0!==n.query.bulk_cnt_choose&&(o=n.query.bulk_cnt_choose),null===o?(e=n.query.bulk_cnt,this.props.cursor.select("show_auto_renew").get()?e=0:!1===this.props.cursor.select("show_auto_renew").get()&&0==e&&(e=1)):(e=o,!1===this.props.cursor.select("show_auto_renew").get()&&0==e&&(e=1)),"undefined"!=typeof window&&e!=n.query.bulk_cnt&&this.onSelectBulk(n.query.bulk_mem_id,e,!1);var i,r="";if(i=0==e?"package_select_yes":"package_select_no","uh_memdeal"==this.props.apptype&&1==n.query.has_bulk){var c=this.props.bulk.bulk[n.query.bulk_mem_id];r=u.default.createElement("div",null,u.default.createElement("div",{className:"section_title"},c.name),u.default.createElement("ul",{className:"package_content"},this.props.cursor.select("show_auto_renew").get()&&u.default.createElement("li",{onClick:function(){a.onSelectBulk(n.query.bulk_mem_id,0,!0)}},u.default.createElement("em",{className:"package_price"},"连续包月",u.default.createElement("strong",null,this.props.bulk.ar[n.query.bulk_mem_id].cost),"元"),u.default.createElement("em",{className:"package_offers"},"自动续费，随时取消"),u.default.createElement("em",{className:i},"  ")),c.list.map(function(t,o){var i="package_select_no";return t==e&&(i="package_select_yes"),u.default.createElement("li",{onClick:function(){a.onSelectBulk(n.query.bulk_mem_id,t,!0)}},u.default.createElement("em",{className:"package_price"},t,"个月",u.default.createElement("strong",null,c.info[t].cost),"元"),u.default.createElement("em",{className:"package_offers"},c.info[t].desc),u.default.createElement("em",{className:i},"  "))})))}var l="";return"uh_memdeal"==this.props.apptype&&3==n.query.mem_id&&(l=u.default.createElement("div",{className:"m2_header"},u.default.createElement("div",{className:"m2_content"},u.default.createElement("img",{className:"m_icon",src:"/static/images/m_icon.png"}),u.default.createElement("div",{className:"m2_name"},this.props.bulk.member_dict[n.query.mem_id].name),u.default.createElement("div",{className:"m2_info"},u.default.createElement("div",{className:"avatar"},u.default.createElement("img",{src:"http://i9.taou.com/maimai/p/2142/6913_115_r75tKqQ2Wu1pFL-a160"}),u.default.createElement("img",{src:"http://i9.taou.com/maimai/p/588/2324_81_P2foHJ5QoXXn-a160"}),u.default.createElement("img",{src:"http://i9.taou.com/maimai/p/1858/4243_110_UEGY9W3QbWOBrT-a160"})),u.default.createElement("div",{className:"m2_text"},"已有",u.default.createElement("strong",null,this.props.bulk.sold[n.query.mem_id]),"人购买"))))),u.default.createElement("div",{className:"envelopeBgColor2"},"chatgift"==n.query.tpl&&u.default.createElement(b.default,s({},this.props,{remark:n.query.remark||"",onSelectCoupon:this.onSelectCoupon})),u.default.createElement(h.default,{title:"选择支付方式"}),l,r,u.default.createElement(_.default,s({},this.props,{tpl:n.query.tpl,set_no_click:this.set_no_click,set_show_auto_renew:this.set_show_auto_renew})))}}]),a}(u.default.Component),c.contextTypes={auth_info:u.default.PropTypes.object,req:u.default.PropTypes.object,fconf:u.default.PropTypes.object},l)}});