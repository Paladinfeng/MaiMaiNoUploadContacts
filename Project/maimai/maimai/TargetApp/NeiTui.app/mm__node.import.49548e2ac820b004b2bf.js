webpackJsonp([103],{1139:function(e,t,a){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},n=a(984),i=a(47),o=function(e){return e&&e.__esModule?e:{default:e}}(i),s=a(1),l=a(17),c=a(15),d=(a(985)("app"),a(991),a(90)),p=a(75),f=a(114),u=a(1004),h=a(41),m=a(115).launch_webview,_=a(46),x=a(116),g=a(168),v=a(999),y=a(1005),b=y.showInputPanel,E=y.clearInput;e.exports=s.createClass({displayName:"exports",mixins:[h],contextTypes:{auth_info:s.PropTypes.object,fconf:s.PropTypes.object,env:s.PropTypes.object},getInitialState:function(){return{expand_txt:null,line_clamp:7,showInput:!1}},componentDidMount:function(){window.onInputFinished=y.onInputFinished,this.checkExpandTxt()},checkExpandTxt:function(){var e=this.props.feed,t=this.getCoordinates(this.refs.txt_wrapper),a=this.getCoordinates(this.refs.txt),r=e.feed.summary||e.feed.richtext||e.feed.text;t<a&&this.setState({expand_txt:r.length<250?"展开":"全文"})},getCoordinates:function(e){return o.default.findDOMNode(e).getBoundingClientRect().height},componentWillUnmount:function(){window.onInputFinished=null},showFeedDetail:l.debounce(function(){var e=this.props.feed,t=this.context,a=t.auth_info,n=t.fconf,i=e.feed.text,o=i.length>250&&"operation_topic"!=e.feed.data_str;if(a.u>0){if(o?_("/article/detail?fid="+e.fid,"查看全文","fetch"):v(e.fid),e.feed.search_qs&&e.feed.search_order){var s=n.online_url+"search/web/s_pb?"+c.stringify(r({srcu:a.u,type:"feed",targetid:e.feed.id,order:e.feed.search_order,qs:e.feed.search_qs},a));fetch(s)}}else o?_("/article/detail?fid="+e.fid,"查看全文","fetch"):location.href="/web/feed_detail?fid="+e.fid},1e3,!0),like:function(e){var t=this;e.stopPropagation();var a=this.props,n=a.feed,i=a.cursor,o=this.context,s=o.auth_info,l=o.fconf;if(i&&s.u>0)try{var d=n.me_like;this.props.cursor.select("me_like").set(1==d?0:1);var f=n.feed.likes;this.props.cursor.select("feed","likes").set((1==d?-1:1)+f);var u=l.online_url+"feed/v3/like?"+c.stringify(r({fid:this.props.feed.fid,like:1==d?0:1},s));fetch(u).then(p.parse_online_json).catch(p.toast_error_handler).catch(function(e){t.props.cursor.select("me_like").set(d),t.props.cursor.select("feed","likes").set(f)})}catch(e){alert(e)}else s.u<0&&m()},gotoDetail:function(e){this.refs.avatar.gotoDetail(e)},spreadComment:function(e,t){var a=this,n=this.context,i=n.auth_info,o=n.fconf,s=this.props.feed,l="live_video_"+s.fid;if(!e)return void toast("回复内容不能为空");var d=new FormData;d.append("fid",s.fid),d.append("text",e),d.append("at_user_info",t);var u=o.online_url+"feed/v3/comment_spread?"+c.stringify(r({},i)),h=fetch(u,{method:"post",body:d}).then(p.parse_online_json).then(function(t){E(l),a.props.cursor.select("spread_feed","feed").set({summary:e})}).catch(p.toast_error_handler);f("请求中...",h)},reply:function(e){e.stopPropagation();var t=this.props.feed;if(window.MaiMai_Native.native_show_inputpanel){var a="live_video_"+t.fid,r=this.props.contact||t.contact;b("回复",a,this.spreadComment,"回复 "+r.name)}else this.replaceState({showInput:!this.state.showInput})},renderInputPanel:function(){if(this.context.env.from_pc){var e=this.props.feed,t=this.props.contact||e.contact,a="回复 "+t.name;return s.createElement("div",{className:this.state.showInput?"p-b":"hidden",style:{marginLeft:50},onClick:function(e){e.stopPropagation()}},s.createElement(u,{placeHolder:a,onClickSend:this.spreadComment,maxWord:250}))}},onExpandTxtClicked:function(e){e.stopPropagation(),"展开"==this.state.expand_txt?this.setState({expand_txt:null,line_clamp:0}):this.showFeedDetail()},renderExpandTxt:function(){var e=this.state.expand_txt;if(e)return s.createElement("div",{className:"text-info liveReply",onClick:this.onExpandTxtClicked},e)},render:function(){var e,t=this.state.line_clamp,a=this.props,r=a.feed,i=a.reply,o=this.props.contact||r.contact,l=x.getCareer(o);e=31!=r.feed.type&&l?" | "+l:"";var c=this.props.author_card&&0==this.props.author_card.dist&&this.props.author_card.id!=o.id&&!i&&0!=o.dist;return s.createElement("li",{className:"list-group-item clearfix",onClick:this.showFeedDetail},s.createElement("div",{className:"media"},s.createElement("div",{className:"media-left"},s.createElement(g,{ref:"avatar",customClass:"topic-avatar",card:o,image_id:this.props.image_id,onClick:this.gotoDetail})),s.createElement("div",{className:"media-body"},s.createElement("div",{className:"lineClamp1",style:{marginBottom:"6px"}},s.createElement("span",{className:"text-primary",onClick:this.gotoDetail},o.name),s.createElement("span",{className:"text-info small"},e),1==o.judge&&s.createElement("span",{className:"add_v_img"})),s.createElement("p",{style:t>0?(0,n.textOverflow)(t):null,ref:"txt_wrapper"},s.createElement(d,{ref:"txt",text:r.feed.summary||r.feed.richtext||r.feed.text,support_dref:!0})),this.renderExpandTxt(),c&&s.createElement("span",{className:"text-info liveReply",onClick:this.reply},"回复"),this.props.children),s.createElement("div",{className:"media-right media-middle text-center"},s.createElement("div",{style:{width:"34px"},onClick:this.like},this.props.cursor&&s.createElement("img",{src:r.me_like?"/static/images/ding2.png":"/static/images/ding1.png",style:w.img}),s.createElement("p",{className:"text-light small"},r.feed.likes>0&&r.feed.likes)))),i&&s.createElement("div",{className:"lightBlueBg p-x-10 p-y-10 m-l-48"},s.createElement("div",{className:"media-body media-middle small text-muted"},s.createElement("span",{className:"text-primary"},i.contact.name),"回复:",s.createElement(d,{text:i.feed.summary||i.feed.richtext||i.feed.text,support_dref:!0}))),c&&this.renderInputPanel())}});var w={heading:{marginTop:-10,marginLeft:-20,marginRight:-20},like:{marginBottom:3},avatarSize:{width:42,height:42,WebkitBorderRadius:"2px"},img:{width:"14px",height:"14px",marginBottom:"4px"},tableCell:{display:"table-cell"},zanBox:{display:"table-cell",textAlign:"center",verticalAlign:"middle",width:50}}},706:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s,l,c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},d=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),p=a(1),f=r(p),u=a(75),h=a(981),m=r(h),_=a(15),x=r(_),g=a(1139),v=r(g),y=a(46),b=(r(y),a(165)),E=r(b),w=a(117),k=r(w),C=a(17),j=(r(C),a(1008)),N=r(j),P=a(982);t.default=e.exports=(l=s=function(e){function t(){var e,a,r,o;n(this,t);for(var s=arguments.length,l=Array(s),d=0;d<s;d++)l[d]=arguments[d];return a=r=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),r.loadMore=function(){try{var e=r.context.req,t=r.props,a=t.feeds,n=t.cursor,i=e.pathname+"?"+x.default.stringify(c({},e.query,{start:parseInt(a.length)+parseInt(e.query.start),jsononly:1}));fetch(i,{credentials:"same-origin"}).then(u.parse_online_json).then(function(e){n.select("feeds").concat(e.data.feeds),n.select("more").set(e.data.more)})}catch(e){}},o=a,i(r,o)}return o(t,e),d(t,[{key:"render",value:function(){var e=this.props,t=e.cursor,a=e.feeds,r=this.context;r.req,r.auth_info;return f.default.createElement("div",null,f.default.createElement(m.default,{title:"全部观点"}),f.default.createElement(P,{hasMore:1==this.props.more,loadMore:this.loadMore,loader:f.default.createElement(E.default,{ref:"loader",reload:this.loadMore,cursor:this.props.cursor.select("loading_status")})},f.default.createElement("div",{className:"panel panel-default"},f.default.createElement("ul",{className:"list-group"},a.map(function(e,a){return f.default.createElement(v.default,{key:e.id,feed:e,cursor:t.select("feeds",a)},f.default.createElement(N.default,{images:e.feed.pics,max_count:3,type_multi:!0}))})))))}}]),t}(f.default.Component),s.contextTypes={req:f.default.PropTypes.object,fconf:f.default.PropTypes.object,auth_info:f.default.PropTypes.object},l);k.default.Constants.large}});