webpackJsonp([266],{879:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s,c,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),d=n(1),p=a(d),f=n(46),_=a(f),m=n(981),h=a(m),g=n(75),w=a(g),v=n(15),y=a(v),b=n(983),k=a(b),x=n(1171),M=a(x),E=n(17),N=a(E),j=n(982),T=a(j),O=n(165),P=a(O),S=n(277),C=n(113),F=n(115);t.default=e.exports=(c=s=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.goToGossipDetail=function(e,t){e.stopPropagation();var a=n.context.env.from_pc;window.MaiMai_Native.native_gossip_detail&&!a?window.MaiMai_Native.native_gossip_detail(""+t.id):(0,_.default)("/web/gossip_detail?webid="+t.webid,t.text,"fetch")},n.renderMoreItem=function(){var e=n.props.company_info,t=e.name+"员工告诉你，"+e.name+"是否值得去",a={share_info:{title:t,icon_url:e.logo,desc:""},more_items:[{title:"分享给微信好友",callback:"share_wxf"},{title:"分享到朋友圈",callback:"share_wxc"}]};return p.default.createElement(k.default,{msg_to_app:a})},n.goToShare=function(e){var t=n.props.company_info,a=t.name+"员工告诉你，"+t.name+"是否值得去",o=window.location.origin+window.location.pathname+"?"+y.default.stringify({webcid:t.webcid,cname:t.name,share:4==e?"friend":"moments",su:n.context.auth_info.u});window.MaiMai_Native&&window.MaiMai_Native.native_share_v2&&window.MaiMai_Native.native_share_v2(e,JSON.stringify({icon_url:t.logo,title:a,url:o}))},n.onBtnClick=N.default.debounce(function(){var e=n.context.auth_info,t=n.props,a=t.remain_unlock,o=t.company_info;if(a>=1){var i="/sdk/company/user_unlock?"+y.default.stringify(l({cname:o.name,webcid:o.webcid},e));fetch(i,{credentials:"include"}).then(w.default.parse_online_json).then(function(){(0,C.sendWebViewBroadcast)("hot_company_gossip_list_reload",{}),n.setState({is_unlock:!0}),1==a&&n.goToShare(3),setTimeout(function(){return window.location.reload()},1==a?300:0)}).catch(function(e){w.default.toast_error_handler(e)}),(0,S.pingback)("hot_company_gossip_list","btn_remain_unlock",a,e)}},500,!0),n.loadMore=function(){n.refs.loader.bindRequest(function(){var e=n.context,t=e.req,a=e.auth_info,o=n.props,i=o.cursor,r=o.gossips,s=o.next_p,c=t.pathname+"?"+y.default.stringify(l({},t.query,a,{jsononly:1,p:s}));return fetch(c,{credentials:"same-origin"}).then(g.parse_online_json).then(function(e){if(e.data.gossips&&e.data.gossips.length>0){var t=r.concat(e.data.gossips);i.select("gossips").set(t),i.select("next_p").set(e.data.next_p),i.select("has_more").set(e.data.has_more)}else i.select("has_more").set(0)}).catch(function(e){return(0,g.toast_error_handler)(e)})})},n.state={is_unlock:n.props.is_unlock||!1},n}return r(t,e),u(t,[{key:"componentWillReceiveProps",value:function(e,t){if(!this.props.wx_sdk_inited&&e.wx_sdk_inited){var n=this.props.company_info,a={title:n.name+"员工告诉你，"+n.name+"是否值得去",desc:n.name+"员工告诉你，"+n.name+"是否值得去",link:window.location.origin+window.location.pathname+"?"+y.default.stringify({webcid:n.webcid,cname:n.name,fr:"wx_share"}),imgUrl:n.logo,success:function(){},cancel:function(){}};t.wx_sdk.onMenuShareAppMessage(a),t.wx_sdk.onMenuShareTimeline(a),t.wx_sdk.onMenuShareQQ(a),t.wx_sdk.onMenuShareQZone(a)}}},{key:"componentDidMount",value:function(){var e=this.context.auth_info,t=this.props.remain_unlock;this.props.is_unlock||(0,S.pingback)("hot_company_gossip_list","remain_unlock",t,e),window.share_wxf=function(){window.MaiMai_Native.native_share(4),(0,S.pingback)("hot_company_gossip_list","share","friends",e)},window.share_wxc=function(){window.MaiMai_Native.native_share(3),(0,S.pingback)("hot_company_gossip_list","share","circle",e)}}},{key:"renderUnlock",value:function(){var e=this.props,t=e.company_info,n=e.remain_unlock,a=void 0;return a=n>1?p.default.createElement("div",{className:"hcg_share_text"},"今天还有",p.default.createElement("span",null,n-1),"次解锁机会"):1==n?p.default.createElement("div",{className:"hcg_share_text"},"分享额外获得",p.default.createElement("span",null,"1"),"次机会"):p.default.createElement("div",{className:"hcg_share_text"},"今日特权已用完，明日登陆可获得",p.default.createElement("span",null,"2"),"次特权"),p.default.createElement("div",{className:"hcg_share_wrap",onClick:this.onBtnClick},a,p.default.createElement("div",{className:"hcg_unlock",style:0==n?{background:"#F2F6F7",color:"#4F4F4F"}:{}},(1==n?"分享解锁":"解锁")+t.name,p.default.createElement("img",{src:"/static/images/company/"+(0==n?"lock_dis":"lock")+".png",alt:"",className:"hcg_unlock_img"})))}},{key:"renderItems",value:function(){var e=this,t=this.props,n=t.gossips,a=t.has_more;return p.default.createElement("div",{style:{marginBottom:130}},p.default.createElement(T.default,{hasMore:0!=a,loadMore:this.loadMore,threshold:30,loader:p.default.createElement(P.default,{ref:"loader",reload:this.loadMore,cursor:this.props.cursor.select("loading_status")})},n.map(function(t,n){return p.default.createElement(M.default,{key:n,gossip:t,fr_topic:"1",cursor:e.props.cursor.select("gossips",n),onItemClick:function(n){return e.goToGossipDetail(n,t)}})})))}},{key:"render",value:function(){var e=this.props,t=e.company_info,n=e.gossips,a=e.inApp;return 0==n.length?p.default.createElement("div",{className:"nullBox"},p.default.createElement("div",{className:"nullList"},"该公司还没有匿名信息")):p.default.createElement("div",{className:"hcg_company_list_bg"},p.default.createElement(h.default,{title:"什么公司值得去-"+t.name}),this.renderMoreItem(),p.default.createElement("div",{className:"hcg_company_bg"},t.tags.map(function(e,t){return p.default.createElement("div",{className:"hcg_company_keyword hcg_company_keyword_"+(t+1),key:t},e)}),p.default.createElement("div",{className:"hcg_company_icon"},p.default.createElement("img",{src:t.logo,alt:""}))),this.renderItems(),!this.state.is_unlock&&p.default.createElement("div",{className:"hcg_fixed_bottom"},a&&this.renderUnlock(),!a&&p.default.createElement("div",{className:"hcg_to_app",onClick:function(){(0,F.launch_webview)("regfr=company_gossip")}},"点击查看更多内幕",p.default.createElement("span",{className:"mm_banner_finger light_right_finger"}))))}}]),t}(p.default.Component),s.contextTypes={fconf:p.default.PropTypes.object,auth_info:p.default.PropTypes.object,req:p.default.PropTypes.object,env:p.default.PropTypes.object,wx_sdk:p.default.PropTypes.object},c)}});