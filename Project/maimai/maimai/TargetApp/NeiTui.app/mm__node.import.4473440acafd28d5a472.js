webpackJsonp([217],{772:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c,s,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},d=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),u=a(1),f=r(u),p=a(981),h=r(p),_=a(75),m=r(_),w=a(15),b=r(w),v=a(46),y=r(v),g=a(76),E=r(g),x=a(114),C=r(x),k=a(113),N=a(1060),j=(r(N),a(1094).gen_extid),B=a(164).getCache,T=a(164).putCache;t.default=e.exports=(s=c=function(e){function t(){var e,a,r,o;n(this,t);for(var c=arguments.length,s=Array(c),d=0;d<c;d++)s[d]=arguments[d];return a=r=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.state={withdrawValue:void 0!=r.props.withdraw_record?r.props.withdraw_record.value:0,fee:void 0!=r.props.withdraw_record?r.props.withdraw_record.fee:0,showCloseMsg:0},r.changeCard=function(e){e.stopPropagation(),(0,y.default)("/contact/account/list_bank_card?type=2","选择银行卡","fetch")},r.submitCheck=function(){var e=r.props.balance,t=r.refs.withdraw_value.value,a=new RegExp("^[0-9]+(.[0-9]+)?$"),n=!a.test(t),l=!n;if(l){var o=parseFloat(t);isNaN(o)&&((0,E.default)("输入金额不正确"),l=!1),0==o&&((0,E.default)("输入金额不能为0"),l=!1),o<=r.state.fee&&((0,E.default)("提现金额不能小等于手续费"),l=!1);var e=parseFloat(e);o>e&&((0,E.default)("可提现余额不足"),l=!1)}return l},r.doRetry=function(e){e.stopPropagation();var t=r.context,a=t.fconf,n=t.auth_info,l=r.props,o=l.selected_card,c=l.withdraw_record,s=j(n.u,"retry"),d=c.ext_id,u=a.web_url+"contact/account/web_callback?"+b.default.stringify({type:"withdraw_retry",card_id:o.id,request_no:s,old_request_no:d}),f=a.online_url+"mmpay/v4/verify_passwd_url?"+b.default.stringify(i({},n)),p=fetch(f,{credentials:"same-origin",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:b.default.stringify(i({request_no:s,web_callback:u,token_biz_type:"WITHDRAW",return_url:a.web_url+"contact/account/return_close"},n))}).then(m.default.parse_online_json).then(function(e){void 0!=e.redirectUrl&&e.redirectUrl.length>0?(0,y.default)(e.redirectUrl,"支付密码","fetch"):(0,E.default)("请求失败,请稍后再试")}).catch(m.default.alert_error_handler);(0,C.default)("请求支付密码中...",p)},r.doSubmit=function(e){e.stopPropagation();var t=r.context,a=t.fconf,n=t.auth_info,l=r.props,o=l.balance,c=l.selected_card;if(r.submitCheck()){var s=r.refs.withdraw_value.value,d=j(n.u,"30003"),u=a.web_url+"contact/account/web_callback?"+b.default.stringify({type:"withdraw",card_id:c.id,value:s,balance:o,request_no:d}),f=a.online_url+"mmpay/v4/verify_passwd_url?"+b.default.stringify(i({},n)),p=fetch(f,{credentials:"same-origin",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:b.default.stringify(i({request_no:d,web_callback:u,token_biz_type:"WITHDRAW",value:s,return_url:a.web_url+"contact/account/return_close"},n))}).then(m.default.parse_online_json).then(function(e){void 0!=e.redirectUrl&&e.redirectUrl.length>0?(0,y.default)(e.redirectUrl,"支付密码","fetch"):(0,E.default)("请求失败,请稍后再试")}).catch(m.default.alert_error_handler);(0,C.default)("请求支付密码中...",p)}},r.showFee=function(){var e=r.context,t=e.fconf,a=e.auth_info,n=r.refs.withdraw_value.value;new RegExp("^[0-9]+(.[0-9]+)?$").test(n)&&fetch(t.online_url+"mmpay/v4/withdraw_fee?"+b.default.stringify(i({value:n,ct:30003},a)),{credentials:"same-origin"}).then(m.default.parse_online_json).then(function(e){if(void 0!=e.fee){var t=parseFloat(e.fee).toFixed(2),a=(n-t).toFixed(2);r.setState({fee:t,withdrawValue:a})}})},r.onCardChage=function(e){r.props.cursor.select("selected_card").set(e)},r.feeComment=function(e){e.stopPropagation(),(0,y.default)("/contact/account/fee_comment","提现手续费说明")},r.onWithrawSuccess=function(){window.MaiMai_Native.close_native(null,!0)},r.hiddenMsg=function(){var e=r.props.withdraw_close_msg;T("withdraw_msg_hidden",e),r.setState({showCloseMsg:0})},o=a,l(r,o)}return o(t,e),d(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.withdraw_close_msg;document.body.style.background="#f7f5f3",(0,k.bindBroadcast)("account_withdraw_success",this.onWithrawSuccess),(0,k.bindBroadcast)("selected_card",this.onCardChage),B("withdraw_msg_hidden",function(a){a!=t&&e.setState({showCloseMsg:1})}.bind(this))}},{key:"componentWillUnmount",value:function(){(0,k.unbindBroadcast)("account_withdraw_success",this.onWithrawSuccess),(0,k.unbindBroadcast)("selected_card",this.onCardChage)}},{key:"render",value:function(){var e=this.props,t=e.balance,a=e.selected_card,r=e.withdraw_record,n=e.cursor,l=void 0,o=void 0,c=1==this.state.showCloseMsg?n.select("withdraw_close_msg").get():null,s=void 0!=r;return this.state.fee>0&&(l=f.default.createElement("div",null,f.default.createElement("div",{className:"cashBox clearfix borderBottom"},f.default.createElement("label",null,"实际到账"),f.default.createElement("p",null,f.default.createElement("span",{style:{float:"right"}},this.state.withdrawValue))),f.default.createElement("div",{className:"cashBox clearfix borderBottom"},f.default.createElement("label",null,"提现手续费"),f.default.createElement("p",null,f.default.createElement("span",{style:{float:"right"}},this.state.fee))))),o=s?f.default.createElement("div",{className:"cashBox clearfix borderBottom"},f.default.createElement("label",null,"转出金额"),f.default.createElement("p",{style:{marginTop:"10px"}},f.default.createElement("input",{type:"number",placeholder:"1-2个工作日内到账，最低5元",ref:"withdraw_value",disabled:"disabled",value:r.value+r.fee}))):f.default.createElement("div",{className:"cashBox clearfix borderBottom"},f.default.createElement("label",null,"转出金额"),f.default.createElement("p",{style:{marginTop:"10px"}},f.default.createElement("input",{type:"number",placeholder:"1-2个工作日内到账，最低5元",ref:"withdraw_value",onChange:this.showFee}))),console.log("selected_card="+JSON.stringify(a)),f.default.createElement("div",null,f.default.createElement(h.default,{title:"转出到银行卡"}),c&&f.default.createElement("div",{className:"withdraw_msg"},f.default.createElement("span",null,c),f.default.createElement("img",{className:"withdraw_msg_close",src:"/static/images/jobs/icon_banner_close.png",onClick:this.hiddenMsg})),f.default.createElement("div",{className:"cashBalance"},"当前余额：",t,"元"),f.default.createElement("div",{className:"borderTop"},f.default.createElement("div",{className:"cashBox clearfix borderBottom"},f.default.createElement("dl",{className:"savedUser"},f.default.createElement("dt",null,f.default.createElement("img",{src:a.icon})),f.default.createElement("dd",{className:"stressText"},"转出到账户"),f.default.createElement("dd",null,"("+a.bank+"**** **** ****"+a.subfix+")")))),o,l,f.default.createElement("div",{className:"switchBankCard clearfix",onClick:this.changeCard},"其他银行卡"),f.default.createElement("a",{href:"javascript:;",className:"submitBtn",onClick:s?this.doRetry:this.doSubmit},"提交"),f.default.createElement("div",{className:"text-muted small p-x",style:{position:"absolute",bottom:"20px"},onClick:this.feeComment},"*提现手续费说明"))}}]),t}(f.default.Component),c.contextTypes={auth_info:f.default.PropTypes.object,req:f.default.PropTypes.object,fconf:f.default.PropTypes.object},s)}});