webpackJsonp([233],{809:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},r=a(1),i=n(r),l=a(46),o=(n(l),a(114)),u=(n(o),a(1046),a(113)),c=(n(u),a(15)),f=n(c),d=a(76),g=n(d),p=a(75),h=n(p),m=a(1096),v=(n(m),a(1097)),k=(n(v),a(164),a(989)),_=(n(k),a(271)),x=n(_),y=a(77),E=n(y),b=a(995),T=n(b),N=a(281),w=(n(N),a(17)),C=a(166),O=a(981),M=a(41),B=a(275),I={container:{position:"relative",padding:"5px 11px 0 11px"},styleInDetail:{maxHeight:"125px",overflow:"hidden"},tagItem:{fontSize:"14px",margin:"0 15px 15px 0",background:"#eff1f2",float:"left",padding:"6px",lineHeight:"16px",borderRadius:"3px",border:"1px solid #eff1f2"},grayBtn:{background:"#fff",color:"#798b9a",border:"1px solid #eee"}},S=function(t,e){return t.cur>e.cur?-1:t.cur<e.cur?1:t.count>e.count?-1:t.count<e.count?1:t.tag<e.tag?-1:t.tag>e.tag?1:0},j=i.default.createClass({displayName:"MarkDetailPanel",mixins:[M,B],contextTypes:{auth_info:i.default.PropTypes.object,fconf:i.default.PropTypes.object},getInitialState:function(){var t=[],e=[];return this.props.tags&&this.props.tags.length>0&&(t=this.props.tags),this.props.alltags&&(e=this.props.alltags,e.sort(S)),{set_default_mark:!!this.props.local_name,name:this.props.name,show_tags:!(!this.props.card||!this.props.card.dist||1!=this.props.card.dist),tags:t,alltags:e}},save:function(){var t=this.context.auth_info,e=this.refs.remark.value.trim(),a=s({u2:this.props.u2,mark_name:e},t);this.state.show_tags&&(a.tags=this.state.tags.join(","));var n="/sdk/update_mark?"+f.default.stringify(a);fetch(n,{credentials:"same-origin"}).then(h.default.parse_online_json).then(function(t){(0,u.sendWebViewBroadcast)("show_edit_mark_icon",e&&e.length>0),(0,g.default)("保存成功"),window.MaiMai_Native.close_native&&window.MaiMai_Native.close_native("",!0)}).catch(function(t){console.log(t),(0,g.default)("设置失败")})},setDefaultMark:function(){this.setState({set_default_mark:!1,name:this.props.local_name})},removeOneTag:function(t){var e=this,a=[];w.each(this.state.tags,function(e){t!=e&&a.push(e)});var n=[];w.each(this.state.alltags,function(e){if(t==e.tag){if(e.count<=1)return;e.cur=0,e.count--}n.push(e)}),console.log("remove tag:"+t),this.setState({tags:a,alltags:n},function(){console.log("current tags:"+e.state.tags),e.forceUpdate()})},setOneTag:function(t){var e=this,a=this.state.tags;w.find(a,function(e){return e==t})||a.push(t);var n=this.state.alltags;w.find(n,function(e){if(e.tag==t)return e.cur=1,e.count++,!0})||n.unshift({tag:t,count:1,cur:1}),console.log("add tag "+t),this.setState({tags:a,alltags:n},function(){console.log("current tags:"+e.state.tags),e.forceUpdate()})},validateTag:function(t){return t=t.trim(),0==t.length?(E.default.toast("请输入分组名称"),!1):t.length>20?(E.default.toast("分组名称不得超过20个汉字"),!1):!(t.indexOf(",")>=0)||(E.default.toast("分组名称不能包含逗号"),!1)},okfunc:function(t){var e=this;this.validateTag(t)&&(E.default.dismiss(),this.setTimeout(function(){e.setOneTag(t)},10))},addTag:function(){if(this.state.tags.length>=10)return void(0,g.default)("最多为一个好友设置10个分组");E.default.popup(i.default.createElement(T.default,{title:"添加分组",text:"",use_input:"1",placeholder:"请输入分组名称",ok:this.okfunc}))},renderCustomGroups:function(){var t=this,e=i.default.createElement("div",{className:"clearfix"},i.default.createElement("span",{onClick:this.addTag,style:[I.tagItem,I.grayBtn]},"+添加分组"),w.map(this.state.alltags,function(e){var a="text-info";1==e.cur&&(a="text-blue");var n=w.debounce(function(){if(1==e.cur)t.removeOneTag(e.tag);else{if(t.state.tags.length>=10)return void(0,g.default)("最多为一个好友设置10个分组");t.setOneTag(e.tag)}},100);return i.default.createElement("span",{style:I.tagItem,className:a,onClick:n},e.tag+"("+e.count+"人)")}));return i.default.createElement(x.default,{title:"自定义好友分组",key:"ctttag"},i.default.createElement("div",{className:"textareaStyleInput"},e))},renderRemark:function(){var t=void 0;return this.state.set_default_mark&&(t=i.default.createElement("div",null,i.default.createElement("div",{className:"localNameContainer"},"推荐设置手机通讯录名字“",this.props.local_name,"”为备注名"),i.default.createElement("div",{className:"setBtn",onClick:this.setDefaultMark},"一键备注"))),i.default.createElement(x.default,{title:"备注信息",key:"remark"},t,i.default.createElement("div",{className:"textareaStyleInput"},i.default.createElement("textarea",{ref:"remark"},this.state.name)))},render:function(){return i.default.createElement("div",null,i.default.createElement(O,{title:"备注信息"}),i.default.createElement("div",{className:"markContainerBg"},this.renderRemark(),this.renderCustomGroups(),i.default.createElement("div",{className:"markBlueBtn",onClick:this.save},"保存")))}});t.exports=C(j)}});