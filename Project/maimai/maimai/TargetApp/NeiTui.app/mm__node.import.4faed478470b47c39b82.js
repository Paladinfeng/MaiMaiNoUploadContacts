webpackJsonp([280],{712:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(1),i=n(o),s=r(981),c=(n(s),r(114)),d=n(c),l=r(75),u=n(l),f=r(15),h=n(f),p=r(76),m=n(p),_=r(113),y=n(_),v=r(1028),g=r(271),b=n(g),q=r(47);e.exports=i.default.createClass({displayName:"exports",contextTypes:{req:i.default.PropTypes.object,auth_info:i.default.PropTypes.object,fconf:i.default.PropTypes.object},componentDidMount:function(){var e=""+this.generateFeedHash();this.props.cursor.select("feed_hash").set(e)},sendFeed:function(){var e=q.findDOMNode(this.refs.textarea).value;if((0,v.checkStrEmpty)(e))return void(0,m.default)("动态内容不能为空");if(e.trim().length>8e3)return void(0,m.default)("最多只能发布8000个字你已超过"+(e.trim().length-8e3)+"个字");var t=this.context,r=t.req,n=t.fconf,o=t.auth_info,i=a({text:e.trim(),tags:r.query.tags,is_realname:1,hash:this.props.cursor.select("feed_hash").get()},o);r.query.id&&(i.operation_topic=r.query.id),r.query.circle&&(i.circle=r.query.circle);var s=n.online_url+"feed/v3/add",c=fetch(s,{credentials:"same-origin",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:h.default.stringify(i)}).then(u.default.parse_online_json).then(function(e){y.default.sendWebViewBroadcast("pub_feed",e.feed),window.MaiMai_Native.close_native("",!0)}).catch(u.default.toast_error_handler);(0,d.default)("发送中..",c)},sendGossip:function(){var e=q.findDOMNode(this.refs.textarea).value;if((0,v.checkStrEmpty)(e))return void(0,m.default)("内容不能为空");if(e.trim().length>140)return void(0,m.default)("最多只能发布140个字你已超过"+(e.trim().length-140)+"个字");var t=this.context,r=t.req,n=t.fconf,o=t.auth_info,i=a({username_type:1,text:e.trim()+(r.query.attach_content?r.query.attach_content:""),tags:r.query.tags,hash:this.props.cursor.select("feed_hash").get()},o);r.query.circle&&(i.circle=r.query.circle);var s=n.online_url+"gossip/v3/add?"+h.default.stringify(i),c=fetch(s,{credentials:"same-origin"}).then(u.default.parse_online_json).then(function(e){y.default.sendWebViewBroadcast("pub_gossip",e.gossip),window.MaiMai_Native.close_native("",!0)}).catch(u.default.toast_error_handler);(0,d.default)("发送中..",c)},send:function(){this.context.req.query.send_gossip?this.sendGossip():this.sendFeed()},generateFeedHash:function(){return Date.now()+this.getRandomInt(0,1e6)},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e))+e},renderSectionHeader:function(){var e=this.context.req;return e.query.section?i.default.createElement(b.default,{title:e.query.section}):null},render:function(){return i.default.createElement("div",null,this.renderSectionHeader(),i.default.createElement("div",{className:"panel-body p-x-10"},i.default.createElement("textarea",{className:"form-control m-b",rows:"7",placeholder:"说上几句吧...",ref:"textarea"}),i.default.createElement("div",{className:"m-x"},i.default.createElement("button",{className:"btn btn-primary btn-block btn-lg",onClick:this.send},"发布"))))}})}});