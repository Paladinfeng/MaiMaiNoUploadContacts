webpackJsonp([26],{1139:function(e,t,a){"use strict";var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},r=a(984),n=a(47),s=function(e){return e&&e.__esModule?e:{default:e}}(n),o=a(1),l=a(17),d=a(15),c=(a(985)("app"),a(991),a(90)),u=a(75),p=a(114),f=a(1004),m=a(41),h=a(115).launch_webview,v=a(46),_=a(116),g=a(168),x=a(999),y=a(1005),b=y.showInputPanel,E=y.clearInput;e.exports=o.createClass({displayName:"exports",mixins:[m],contextTypes:{auth_info:o.PropTypes.object,fconf:o.PropTypes.object,env:o.PropTypes.object},getInitialState:function(){return{expand_txt:null,line_clamp:7,showInput:!1}},componentDidMount:function(){window.onInputFinished=y.onInputFinished,this.checkExpandTxt()},checkExpandTxt:function(){var e=this.props.feed,t=this.getCoordinates(this.refs.txt_wrapper),a=this.getCoordinates(this.refs.txt),i=e.feed.summary||e.feed.richtext||e.feed.text;t<a&&this.setState({expand_txt:i.length<250?"展开":"全文"})},getCoordinates:function(e){return s.default.findDOMNode(e).getBoundingClientRect().height},componentWillUnmount:function(){window.onInputFinished=null},showFeedDetail:l.debounce(function(){var e=this.props.feed,t=this.context,a=t.auth_info,r=t.fconf,n=e.feed.text,s=n.length>250&&"operation_topic"!=e.feed.data_str;if(a.u>0){if(s?v("/article/detail?fid="+e.fid,"查看全文","fetch"):x(e.fid),e.feed.search_qs&&e.feed.search_order){var o=r.online_url+"search/web/s_pb?"+d.stringify(i({srcu:a.u,type:"feed",targetid:e.feed.id,order:e.feed.search_order,qs:e.feed.search_qs},a));fetch(o)}}else s?v("/article/detail?fid="+e.fid,"查看全文","fetch"):location.href="/web/feed_detail?fid="+e.fid},1e3,!0),like:function(e){var t=this;e.stopPropagation();var a=this.props,r=a.feed,n=a.cursor,s=this.context,o=s.auth_info,l=s.fconf;if(n&&o.u>0)try{var c=r.me_like;this.props.cursor.select("me_like").set(1==c?0:1);var p=r.feed.likes;this.props.cursor.select("feed","likes").set((1==c?-1:1)+p);var f=l.online_url+"feed/v3/like?"+d.stringify(i({fid:this.props.feed.fid,like:1==c?0:1},o));fetch(f).then(u.parse_online_json).catch(u.toast_error_handler).catch(function(e){t.props.cursor.select("me_like").set(c),t.props.cursor.select("feed","likes").set(p)})}catch(e){alert(e)}else o.u<0&&h()},gotoDetail:function(e){this.refs.avatar.gotoDetail(e)},spreadComment:function(e,t){var a=this,r=this.context,n=r.auth_info,s=r.fconf,o=this.props.feed,l="live_video_"+o.fid;if(!e)return void toast("回复内容不能为空");var c=new FormData;c.append("fid",o.fid),c.append("text",e),c.append("at_user_info",t);var f=s.online_url+"feed/v3/comment_spread?"+d.stringify(i({},n)),m=fetch(f,{method:"post",body:c}).then(u.parse_online_json).then(function(t){E(l),a.props.cursor.select("spread_feed","feed").set({summary:e})}).catch(u.toast_error_handler);p("请求中...",m)},reply:function(e){e.stopPropagation();var t=this.props.feed;if(window.MaiMai_Native.native_show_inputpanel){var a="live_video_"+t.fid,i=this.props.contact||t.contact;b("回复",a,this.spreadComment,"回复 "+i.name)}else this.replaceState({showInput:!this.state.showInput})},renderInputPanel:function(){if(this.context.env.from_pc){var e=this.props.feed,t=this.props.contact||e.contact,a="回复 "+t.name;return o.createElement("div",{className:this.state.showInput?"p-b":"hidden",style:{marginLeft:50},onClick:function(e){e.stopPropagation()}},o.createElement(f,{placeHolder:a,onClickSend:this.spreadComment,maxWord:250}))}},onExpandTxtClicked:function(e){e.stopPropagation(),"展开"==this.state.expand_txt?this.setState({expand_txt:null,line_clamp:0}):this.showFeedDetail()},renderExpandTxt:function(){var e=this.state.expand_txt;if(e)return o.createElement("div",{className:"text-info liveReply",onClick:this.onExpandTxtClicked},e)},render:function(){var e,t=this.state.line_clamp,a=this.props,i=a.feed,n=a.reply,s=this.props.contact||i.contact,l=_.getCareer(s);e=31!=i.feed.type&&l?" | "+l:"";var d=this.props.author_card&&0==this.props.author_card.dist&&this.props.author_card.id!=s.id&&!n&&0!=s.dist;return o.createElement("li",{className:"list-group-item clearfix",onClick:this.showFeedDetail},o.createElement("div",{className:"media"},o.createElement("div",{className:"media-left"},o.createElement(g,{ref:"avatar",customClass:"topic-avatar",card:s,image_id:this.props.image_id,onClick:this.gotoDetail})),o.createElement("div",{className:"media-body"},o.createElement("div",{className:"lineClamp1",style:{marginBottom:"6px"}},o.createElement("span",{className:"text-primary",onClick:this.gotoDetail},s.name),o.createElement("span",{className:"text-info small"},e),1==s.judge&&o.createElement("span",{className:"add_v_img"})),o.createElement("p",{style:t>0?(0,r.textOverflow)(t):null,ref:"txt_wrapper"},o.createElement(c,{ref:"txt",text:i.feed.summary||i.feed.richtext||i.feed.text,support_dref:!0})),this.renderExpandTxt(),d&&o.createElement("span",{className:"text-info liveReply",onClick:this.reply},"回复"),this.props.children),o.createElement("div",{className:"media-right media-middle text-center"},o.createElement("div",{style:{width:"34px"},onClick:this.like},this.props.cursor&&o.createElement("img",{src:i.me_like?"/static/images/ding2.png":"/static/images/ding1.png",style:w.img}),o.createElement("p",{className:"text-light small"},i.feed.likes>0&&i.feed.likes)))),n&&o.createElement("div",{className:"lightBlueBg p-x-10 p-y-10 m-l-48"},o.createElement("div",{className:"media-body media-middle small text-muted"},o.createElement("span",{className:"text-primary"},n.contact.name),"回复:",o.createElement(c,{text:n.feed.summary||n.feed.richtext||n.feed.text,support_dref:!0}))),d&&this.renderInputPanel())}});var w={heading:{marginTop:-10,marginLeft:-20,marginRight:-20},like:{marginBottom:3},avatarSize:{width:42,height:42,WebkitBorderRadius:"2px"},img:{width:"14px",height:"14px",marginBottom:"4px"},tableCell:{display:"table-cell"},zanBox:{display:"table-cell",textAlign:"center",verticalAlign:"middle",width:50}}},1430:function(e,t,a){"use strict";var i=a(1),r=(a(50),a(41)),n=(a(46),a(78)),s=a(116),o=i.createClass({displayName:"ContactLine",mixins:[r],contextTypes:{auth_info:i.PropTypes.object,req:i.PropTypes.object},gotoDetail:function(){try{n(this.props.contact.encode_mmid||this.props.contact.mmid,this.context)}catch(e){alert(e)}},render:function(){var e=this.props.contact,t=s.getCareer(e);return i.createElement("div",{onClick:this.gotoDetail},i.createElement("div",{className:"media-left"},i.createElement("img",{className:"liveAuthor",src:e.avatar})),i.createElement("div",{className:"media-body media-middle"},i.createElement("span",{className:"text-primary"},e.name),i.createElement("span",{className:"small text-muted"}," | "+t),1==e.judge&&i.createElement("span",{className:"add_v_img"})))}});e.exports=o},1431:function(e,t,a){"use strict";function i(e){var t=e.company?e.company:"",a=e.position?e.position:"",i="";if(t.length>0&&a.length>0){var r=t.substring(t.length-1,t.length),n=a.substring(0,1);escape(r).indexOf("%u")<0&&escape(n).indexOf("%u")<0&&(i=" ")}return t+i+a}t.get_contact_title=i},1432:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var r=a(1),n=i(r),s=a(278),o=i(s),l=a(50),d=i(l),c=n.default.createClass({displayName:"RecordVideoCard",makeTimeString:function(e){var t="",a=e%60;if(t+=a,(e=(e-a)/60)>0){var i=e%60;if(t=i+":"+t,(e=(e-i)/60)>0){t=e%60+":"+t}}return t},enter:function(){var e=this.props,t=e.live_info,a=e.lid;(0,d.default)("/article/weblive?id="+a+"&vid="+t.liveid+"&is_live=0","职播回放")},render:function(){var e=this.props.live_info,t=[];if(e){var a=(0,o.default)(1e3*e.start_time).format("YYYY-MM-DD"),i=this.makeTimeString(e.video_time),r=e.imgs.url?e.imgs.url:"/static/images/live_empty.png";t.push(n.default.createElement("img",{style:p.videoCard,className:"livePlayBg bgTranslate",src:r})),t.push(n.default.createElement("div",{style:p.videoCardText},n.default.createElement("div",{style:p.videoCardTextLeft},n.default.createElement("span",null,a)),n.default.createElement("div",{style:p.videoCardTextRight},n.default.createElement("span",null,i))))}return n.default.createElement("div",{style:p.cell,onClick:this.enter},t)}}),u=n.default.createClass({displayName:"RenderRecordVideos",render:function(){var e=this.props,t=e.infos,a=e.lid,i=[],r=t.length%3;r=0==r?3:r;for(var s=(t.length+3-r)/3,o=0;o<s;o++){for(var l=[],d=0;d<3;d++){var u=3*o+d;u<t.length?l.push(n.default.createElement(c,{id:u,live_info:t[u],lid:a})):l.push(n.default.createElement(c,{id:u}))}i.push(n.default.createElement("div",{style:p.flexContainer,id:s},l))}return n.default.createElement("div",{style:p.container},i)}}),p={container:{marginLeft:"-10px"},flexContainer:{display:"table",width:"100%",tableLayout:"fixed",marginTop:"10px",marginBottom:"10px"},cell:{display:"table-cell",position:"relative",height:"65px",width:"33.3%",overflow:"hidden"},videoCard:{maxWidth:"100%",margin:"10px",marginTop:"0px"},videoCardText:{position:"absolute",bottom:0,left:0,width:"100%",height:"20px",fontSize:"8px",color:"#FFFFFF"},videoCardTextLeft:{float:"left",marginLeft:"15px",lineHeight:"20px"},videoCardTextRight:{float:"right",marginRight:"5px",lineHeight:"20px"}};e.exports.RecordVideoCard=c,e.exports.RenderRecordVideos=u},720:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o,l,d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},c=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),u=a(1),p=i(u),f=a(75),m=a(76),h=i(m),v=a(276),_=(i(v),a(981)),g=i(_),x=a(15),y=i(x),b=a(1139),E=i(b),w=a(1008),N=i(w),C=a(46),k=i(C),T=a(50),P=i(T),j=a(113),B=a(983),D=i(B),O=a(115),F=a(165),q=(i(F),a(117)),M=i(q),R=a(90),I=(i(R),a(986)),S=(i(I),a(1017)),L=(i(S),a(1059)),H=(i(L),a(988)),V=i(H),z=a(1430),A=i(z),W=a(17),J=i(W),U=a(1135),Y=i(U),G=a(170),K=i(G),Q=a(993),X=i(Q),Z=a(278),$=i(Z),ee=a(272),te=(i(ee),a(1431),a(1432)),ae=a(114),ie=i(ae);t.default=e.exports=(l=o=function(e){function t(){var e,a,i,s;r(this,t);for(var o=arguments.length,l=Array(o),c=0;c<o;c++)l[c]=arguments[c];return a=i=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.native_publish_success=function(e){var t=JSON.parse(e).publish_return_data;i.reloadFeed(t.feed)},i.reloadFeed=function(e){try{var t={fid:e.id,feed:{id:e.id,uid:e.main.u.id,text:e.main.text,crtime_string:e.crtime,likes:0},contact:e.main.u,me_like:!1};i.props.cursor.select("feeds").concat([t])}catch(e){alert(e)}},i.post=function(){var e=i.context,t=e.req;e.auth_info.u>0?(0,Y.default)(JSON.stringify({target:"live_add_feed",title:"留言",right_button_text:"发布",text_holder:"说上几句吧...",extra_infomation:JSON.stringify({hash:K.default.generateFeedHash(),livecast:t.query.id})})):(0,O.launch_webview)()},i.stop=function(){if(confirm("关闭职播后，不能再进入职播间，也不能重新打开。")){var e=i.context,t=e.req,a=e.fconf,r=e.auth_info,n=a.online_url+"user/v4/modify_live_stat?"+y.default.stringify(d({lid:t.query.id,status:3},r)),s=fetch(n).then(f.parse_online_json).then(function(){(0,h.default)("职播已关闭"),i.props.cursor.select("tag_datas","status").set(3)}).catch(f.toast_error_handler);(0,ie.default)("请稍候..",s)}},i.follow=function(){var e=i.context,t=e.req,a=e.fconf,r=e.auth_info,n=a.online_url+"user/v4/sub_live?"+y.default.stringify(d({lid:t.query.id},r)),s=fetch(n).then(f.parse_online_json).then(function(){(0,h.default)("已关注"),i.props.cursor.select("subbed").set(!0),i.props.cursor.select("subbed_count").set(i.props.cursor.select("subbed_count").get()+1);var e=i.props.cursor.select("subbed_users").get(),t=i.props.cursor.select("my_card").get(),a=[];a.push(t),J.default.map(e,function(e){a.push(e)}),i.props.cursor.select("subbed_users").set(a)}).catch(f.toast_error_handler);(0,ie.default)("请稍候..",s)},i.unfollow=function(){var e=i.context,t=e.req,a=e.fconf,r=e.auth_info,n=a.online_url+"user/v4/unsub_live?"+y.default.stringify(d({lid:t.query.id},r)),s=fetch(n).then(f.parse_online_json).then(function(){(0,h.default)("已取消关注"),i.props.cursor.select("subbed").set(!1),i.props.cursor.select("subbed_count").set(i.props.cursor.select("subbed_count").get()-1);var e=i.props.cursor.select("subbed_users").get(),t=i.props.cursor.select("my_card").get(),a=[];J.default.map(e,function(e){e.mmid!=t.mmid&&a.push(e)}),i.props.cursor.select("subbed_users").set(a)}).catch(f.toast_error_handler);(0,ie.default)("请稍候..",s)},i.renderBottomButtons=function(){var e=["留言"],t=[i.post];return i.context.auth_info.u>0&&((1==i.props.tag_datas.status||2==i.props.tag_datas.status)&&0==i.props.author_card.dist?(e.push("关闭职播"),t.push(i.stop)):i.props.subbed?(e.push("取消关注"),t.push(i.unfollow)):(e.push("关注"),t.push(i.follow))),p.default.createElement(V.default,{btns:e,actions:t})},i.edit=function(){(0,k.default)("/article/edit_live?id="+i.context.req.query.id,"编辑职播",{live:i.props.tag_datas})},i.reloadData=function(e){i.props.cursor.select("tag_datas").merge({title:e.title,desc:e.description,start_time:e.start})},i.enter=function(){var e=i.props,t=e.tag_datas,a=(e.author_card,e.screenshot);if(i.context.auth_info.u<0)return void(a&&a.streamid&&(0,P.default)("/article/weblive?id="+i.context.req.query.id+"&vid="+a.streamid+"&is_live=1","职播"));1==t.status&&(window.MaiMai_Native&&window.MaiMai_Native.native_live_video?window.MaiMai_Native.native_live_video(i.context.req.query.id,0==i.props.author_card.dist):alert("您需要升级脉脉到最新版才能进入职播间"))},i.startTimeFormat=function(e){var t=(0,$.default)(Date.now()),a=(0,$.default)(e),i=(0,$.default)(e).startOf("day"),r=(0,$.default)(Date.now()).add("days",1);return t.startOf("day").isSame(i)?"今天 "+a.format("HH:mm"):r.startOf("day").isSame(i)?"明天 "+a.format("HH:mm"):a.format("M月D日 HH:mm")},s=a,n(i,s)}return s(t,e),c(t,[{key:"renderContent",value:function(){var e=this,t=this.props.feeds;return[p.default.createElement("div",{key:"content-1",className:"panel-heading"},p.default.createElement("span",null," "),p.default.createElement("span",{className:"text-muted pull-left"},"留言")),p.default.createElement("ul",{key:"content-2",className:"list-group"},t.map(function(t,a){var i=null;return t.spread_feed&&(i=t.spread_feed,i.contact=e.props.author_card),p.default.createElement(E.default,{key:t.id,feed:t,author_card:e.props.author_card,reply:i,cursor:e.props.cursor.select("feeds",a)},p.default.createElement(N.default,{images:t.feed.pics,max_count:3,type_multi:!0}))}))]}},{key:"renderLivePlayImg",value:function(){var e=this.props,t=e.screenshot,a=e.tag_datas;e.author_card;return 3==a.status?p.default.createElement("img",{className:"livePlayBg bgTranslate",src:"/static/images/live_close.png"}):t&&t.streamid?p.default.createElement("div",null,p.default.createElement("img",{className:"livePlay",src:"/static/images/play_black.png"}),p.default.createElement("img",{className:"livePlayBg bgTranslate",src:t.url})):1==a.status?a.start_time&&(0,$.default)(a.start_time).isAfter(Date.now())?p.default.createElement("img",{className:"livePlayBg bgTranslate",src:"/static/images/live_not_start.png"}):p.default.createElement("img",{className:"livePlayBg bgTranslate",src:"/static/images/live_not_open.png"}):void 0}},{key:"renderRecordVideo",value:function(){var e=this.props.screenshot;if(e&&e.hislives&&e.hislives.length>0)return p.default.createElement("div",{className:"clearfix"},p.default.createElement("span",{className:"text-muted pull-left"},"精彩回放"),p.default.createElement(te.RenderRecordVideos,{infos:e.hislives,lid:this.context.req.query.id}))}},{key:"renderSubbedUsers",value:function(){var e=this.props,t=e.subbed_users,a=e.subbed_count;if(a&&a>0&&t){var i=[],r=t.length;return J.default.map(t,function(e){i.push(p.default.createElement(ne,{uid:e.encode_mmid||e.mmid,avatar:e.avatar,index:r})),r--}),a>t.length&&i.push(p.default.createElement(ne,{uid:"",avatar:"/static/images/more.png",index:r})),p.default.createElement("div",{className:"clearfix"},p.default.createElement("div",{style:re.subbedInfo},p.default.createElement("span",{className:"text-muted small"},a,"人关注该职播"),i))}}},{key:"componentDidMount",value:function(){window.edit=this.edit,(0,j.bindBroadcast)("edit_live",this.reloadData),(0,j.bindBroadcast)("native_publish_success",this.native_publish_success)}},{key:"componentWillUnmount",value:function(){(0,j.unbindBroadcast)("edit_live",this.reloadData),(0,j.unbindBroadcast)("native_publish_success",this.native_publish_success)}},{key:"render",value:function(){var e=this.props,t=e.tag_datas,a=e.author_card,i=e.screenshot,r=(this.context.auth_info,{share_info:{name:"职播",title:t.title,desc:t.description,card_id:t.id+"",card_type:6}});0==a.dist&&3!=t.status?r.more_items=[{title:"分享",callback:"MaiMai_Native.native_share(1)"},{title:"编辑",callback:"edit()"}]:r.more_items=[{title:"分享",callback:"MaiMai_Native.native_share(1)"}],console.log(t);var n=i&&i.streamid&&"正在职播..."||1==t.status&&new Date(t.start_time)>new Date&&"预计职播时间:"+this.startTimeFormat(t.start_time)||null;return console.log(n),p.default.createElement("div",null,p.default.createElement(g.default,{title:t.title}),p.default.createElement(D.default,{msg_to_app:r}),p.default.createElement("div",{className:"p-x p-t-15"},p.default.createElement("p",{className:"topicTitle",style:{marginLeft:"0"}},t.title),n&&p.default.createElement("div",{className:"clearfix"},p.default.createElement("span",{className:"fl video_icon imacss imacss-video_icon"}),p.default.createElement("span",{className:"fl orangeTxt liveTime"},n)),p.default.createElement("div",{className:"livePlayBox",onClick:this.enter},this.renderLivePlayImg()),this.renderRecordVideo(),t.description&&p.default.createElement("div",{className:"text-muted"},p.default.createElement(X.default,{text:t.description,support_dref:!0})),this.renderSubbedUsers()),p.default.createElement("div",{className:"border-dashed-top p-x p-y-10"},p.default.createElement(A.default,{contact:a})),p.default.createElement("div",{className:"panel panel-default"},this.renderContent()),this.renderBottomButtons())}}]),t}(p.default.Component),o.contextTypes={req:p.default.PropTypes.object,fconf:p.default.PropTypes.object,auth_info:p.default.PropTypes.object},l);var re={expand:{marginRight:"25px",marginLeft:"25px"},footer:{paddingTop:"5px",paddingBottom:"15px",textAlign:"center",fontSize:M.default.Constants.large},subbedInfo:{float:"right",fontSize:M.default.Constants.large,marginRight:"15px",marginBottom:"10px"},subbedCard:{width:"25px",height:"25px",borderRadius:"12.5px",border:"1px solid #FFFFFF",position:"relative",margin:"0 -10px 0 0"}},ne=p.default.createClass({displayName:"ImageItem",contextTypes:{auth_info:p.default.PropTypes.object,req:p.default.PropTypes.object},gotoContactDetail:function(e){if(e.stopPropagation(),this.props.uid){if(this.context.auth_info.u<0)return void(0,O.launch_webview)();launch_contact_detail(this.props.uid,this.context)}},render:function(){var e=re.subbedCard;return e.zIndex=this.props.index,p.default.createElement("img",{style:e,src:this.props.avatar})}})}});