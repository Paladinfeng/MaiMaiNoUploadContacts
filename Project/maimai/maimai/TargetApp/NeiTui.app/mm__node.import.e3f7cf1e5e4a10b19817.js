webpackJsonp([49],{1568:function(e,t,a){"use strict";var i=a(1),s=i.createClass({displayName:"UploadImg",render:function(){return i.createElement("div",{className:"uploadBox p-y-10 p-x-10 borderBottom"},i.createElement("div",{className:"fr uploadImg",onClick:this.props.onClick||function(){}},i.createElement("img",{id:"authPostImg",src:this.props.url})),i.createElement("div",{className:"uploadTxt"},i.createElement("textarea",{placeholder:"输入文字或截图描述",ref:"textarea",onChange:this.props.changeContent})))}});e.exports=s},1569:function(e,t,a){"use strict";var i=a(1),s=i.createClass({displayName:"LayerImgMobile",render:function(){return i.createElement("div",null,i.createElement("div",{className:"layerCover",onClick:this.props.dimissLayer}),i.createElement("div",{className:"layerImgMobile"},i.createElement("div",{className:"layerImgBox",onClick:this.props.dimissLayer},i.createElement("div",{className:"imgTable"},i.createElement("div",{className:"imgTableCell"},i.createElement("img",{src:this.props.url})))),i.createElement("div",{className:"delImg"},i.createElement("img",{src:"/static/images/delImg.png",onClick:this.props.deleteImg}))))}});e.exports=s},912:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var s,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},n=a(1),r=i(n),o=a(17),c=(i(o),a(75)),d=i(c),m=a(50),u=(i(m),a(46)),f=(i(u),a(994)),h=i(f),p=a(15),g=i(p),v=a(1027),y=(i(v),a(164)),E=a(1568),b=i(E),k=a(1097),C=i(k),N=a(1569),w=i(N),T=a(167),x=a(981),_=i(x),S=a(76),I=i(S),M=(a(47),"");e.exports=r.default.createClass({displayName:"exports",contextTypes:{auth_info:r.default.PropTypes.object,req:r.default.PropTypes.object,fconf:r.default.PropTypes.object},componentDidMount:function(){document.body.style.background="#f9f9f9",document.body.style.paddingBottom="20px"},getInitialState:function(){return{items:this.props.items,showTP:!1,url:"/static/images/add_member.png",hasResultUrl:!1,needShowImg:!1,time:this.curentTime(),ftid:this.props.id,fid:"",timeMill:""}},renderEmpty:function(){if(0==this.props.items.length)return r.default.createElement("div",{className:"nullBox"},r.default.createElement("div",{className:"nullList"},"列表为空"))},onRowClicked:function(e){if(null!=this.state.items&&0!=this.state.items.length){for(var t=0;t<this.state.items.length;t++)this.state.items[t].id===e.id&&(this.state.items[t].checkFlag=1==e.checkFlag?0:1);this.setState({items:this.state.items})}},curentTime:function(){s=new Date;var e=s.getFullYear(),t=s.getMonth()+1,a=s.getDate(),i=s.getHours(),l=s.getMinutes(),n=e+"-";return t<10&&(n+="0"),n+=t+"-",a<10&&(n+="0"),n+=a+" ",i<10&&(n+="0"),n+=i+":",l<10&&(n+="0"),n+=l},showSelectPhotoMenu:function(){this.state.hasResultUrl?this.setState({needShowImg:!0}):this.setState({showTP:!0})},onDimissCover:function(){this.setState({needShowImg:!1})},deletePhoto:function(){(0,T.showModalForConfirm)({title:"确定删除该图片吗?",ok_text:"确定",ok:function(){this.setState({fid:"",needShowImg:!1,hasResultUrl:!1,url:"/static/images/add_member.png"})}.bind(this),cancel_text:"取消"})},onSelectPhotoClick:function(e,t){var a=this;if(!isNaN(t))if(-1===t||0===t)this.setState({showTP:!1});else{this.setState({showTP:!1});var i={type:2,compress:.6,security:1,select_type:t};(0,y.uploadImageToServer)(JSON.stringify(i),function(e){var i=JSON.parse(e),s={};s.upload_type=t,s.id=i.id,s.url=i.url,s.turl=i.turl,a.setState({fid:i.id,url:i.url,hasResultUrl:!0}),forceUpdate()})}},onTimeClick:function(){var e=this;(0,y.showDatePicker)("yyyy-MM-dd HH:mm",this.state.time,s.getTime,function(t){var a=JSON.parse(t),i=new Date;if(a.milli_sec_since1970>i.getTime())return void(0,I.default)("故障发生时间不能大于当前时间");e.setState({time:a.format_time,timeMill:a.milli_sec_since1970})})},submit:function(){for(var e=M,t=[],a=0;a<this.state.items.length;a++)1===this.state.items[a].checkFlag&&t.push(this.state.items[a].id);if(""==t||0===t.length)return void(0,I.default)("请选择遇到的问题");var i=e.trim();if(void 0!=i&&""!=i&&i.length>500){var n=i.length-500;return void(0,I.default)("最多输入500个字,已经超过"+n+"字")}var r=this.context,o=(r.req,r.fconf),c=r.auth_info,m=this.state.timeMill;void 0!=m&&""!=m||(m=s.getTime()),m=Math.round(m/1e3);var u=t.toString(),f=l({ftid:this.state.ftid,subftid:u,u:c.u,fid:this.state.fid,pbtime:m},c,{text:i}),h=o.online_url+"other/v4/feedback",p=fetch(h,{credentials:"same-origin",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:g.default.stringify(f)}).then(d.default.parse_online_json).then(function(e){(0,I.default)("提交成功"),window.MaiMai_Native.close_native("",!0)}).catch(d.default.toast_error_handler);show_progress("发送中..",p)},handleChange:function(e){M=e.target.value},render:function(){var e=this;return r.default.createElement("div",null,r.default.createElement(_.default,{title:"意见反馈"}),r.default.createElement("div",{className:"m-t-md m-b m-l text-muted"},"请选择遇到的问题"),r.default.createElement("div",null,this.state.items.map(function(t){return r.default.createElement(h.default,{key:t.id,title:t.text,checked:1==t.checkFlag,checkRowClicked:function(a){e.onRowClicked(t)}})})),r.default.createElement("div",{class:"perTips"}),r.default.createElement("div",{className:"privayBox comtBox2"},r.default.createElement("div",{className:"comtChoose clearfix",onClick:function(){return e.onTimeClick()}},r.default.createElement("span",{className:"feedback_left"},"故障发生时间"),r.default.createElement("span",{className:"arrow-feedback_bg"},this.state.time))),this.renderEmpty(),r.default.createElement("div",{class:"perTips"}),r.default.createElement("div",{className:"m-t-md m-b m-l text-muted"},"补充说明(选填)"),r.default.createElement("div",{className:"borderTop"},r.default.createElement(b.default,{onClick:function(t){e.showSelectPhotoMenu()},url:this.state.url,changeContent:this.handleChange})),this.state.showTP?r.default.createElement(C.default,{onClick:function(t,a){e.onSelectPhotoClick(t,a)}}):null,this.state.needShowImg?r.default.createElement(w.default,{url:this.state.url,dimissLayer:this.onDimissCover,deleteImg:this.deletePhoto}):null,r.default.createElement("div",{class:"perTips"}),r.default.createElement("div",{className:"m-x m-t"},r.default.createElement("button",{className:"btn btn-secondary btn-block btn-lg",onClick:this.submit},"提交")),r.default.createElement("div",{class:"perTips"}))}})}});