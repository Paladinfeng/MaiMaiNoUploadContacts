webpackJsonp([37],{1128:function(e,t,a){"use strict";(function(t){function r(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a}var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},l=a(117),o=a(114),i=r(o),u=a(15),c=r(u),d=a(75),p=a(1),f=a(46),m=(a(50),a(90)),b=a(41),h=a(1006).tab_manager,_=a(77),v=a(995),g=a(17),y=a(76);e.exports=p.createClass({displayName:"exports",mixins:[b],contextTypes:{auth_info:p.PropTypes.object,fconf:p.PropTypes.object},gotoDetail:g.debounce(function(){var e=this.props;e.cursor;s(e,["cursor"]).tab_manager=h(),f("/article/detail?fid="+this.props.feed.id,"查看全文","fetch")},1e3,!0),sendTitle:function(e){var t=this,a=this.context,r=a.fconf,s=a.auth_info,l=fetch(r.online_url+"feed/v3/save_article_title?"+c.default.stringify(n({},s,{fid:this.props.feed.id,title:e}))).then(d.parse_online_json).then(function(a){t.props.cursor.select("main","title").set(e)}).catch(d.toast_error_handler);(0,i.default)("请求中...",l)},addTitle:function(e){var a=this;e.stopPropagation(),_.popup(p.createElement(v,{title:"请输入专栏标题",placeholder:"最多30字",ok:function(e){return e=t.trim(e||""),e.length<=0?void y("专栏标题不能为空"):e.length>60?void y("专栏标题不能超过30字"):(a.sendTitle(e),void _.dismiss())}}))},render:function(){var e=this.props.feed,t=e.main.title||e.main.raw_text||e.main.rtext||e.main.text,a=e.main.pics,r=e.crtime,s=!!e.main.title,n=a&&a.length>0&&a[0],o=n&&n.turl,i="";return e.likes.n>0&&e.comments.n>0?i=e.likes.n+" 赞 "+e.comments.n+" 评论":e.likes.n>0?i=e.likes.n+" 赞":e.comments.n>0&&(i=e.comments.n+" 评论"),p.createElement("li",{className:"list-group-item",onClick:this.gotoDetail},p.createElement("div",{className:"media list-group-item-heading"},p.createElement("div",{className:"media-body"},p.createElement("div",{style:x.heading,className:"media-heading"},p.createElement(m,{text:t,support_dref:!0}))),o&&p.createElement("div",{className:"media-right"},p.createElement("img",{className:"media-object",style:(0,l.square)(72),src:o}))),p.createElement("div",{className:"list-group-item-text"},p.createElement("span",null," "),p.createElement("span",{className:"pull-left text-light small"},r),p.createElement("span",{className:"pull-right text-light small"},i),this.props.addTitle&&s&&0==this.props.card.dist&&p.createElement("span",{className:"pull-right button btn btn-black-outline",style:x.addTitltButton},"已添加"),this.props.addTitle&&!s&&0==this.props.card.dist&&p.createElement("span",{onClick:this.addTitle,className:"pull-right button btn btn-blue-outline",style:x.addTitltButton},"添加标题")))}});var x={heading:{WebkitLineClamp:"3",maxHeight:72,minHeight:40,fontSize:16,lineHeight:"23px",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",wordBreak:"break-word"},addTitltButton:{padding:"2px 10px 2px 10px",marginTop:"-4px",marginRight:"10px",height:"22px",fontSize:"10px"}}}).call(t,a(280))},1129:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},n=a(1),l=r(n),o=a(17),i=r(o),u=a(15),c=r(u),d=a(76),p=r(d),f=a(75),m=r(f),b=a(281),h=r(b),_=a(114),v=r(_),g=a(115);e.exports=l.default.createClass({displayName:"exports",contextTypes:{auth_info:l.default.PropTypes.object,fconf:l.default.PropTypes.object},propsTypes:{card:l.default.PropTypes.object,cursor:l.default.PropTypes.object,no_icon:l.default.PropTypes.bool},sub:i.default.debounce(function(e){var t=this.props,a=t.card,r=t.cursor,n=this.context,l=n.auth_info,o=n.fconf,i=r.get(),u=i.sub_data,d=i.sub_number;if(l.u<0)return(0,g.launch_webview)(),void e.stopPropagation();var f=u.is_subbed?"sub_remove?":"sub_add?",b=u.is_subbed?"取消订阅成功":"订阅成功",h=o.online_url+"feed/v3/"+f+c.default.stringify(s({sub_id:a.id},l)),_=fetch(h).then(m.default.parse_online_json).then(function(e){(0,p.default)(b);var t=!u.is_subbed,a=d.count+(t?1:-1);r.select("sub_data","is_subbed").set(t),r.select("sub_number","count").set(a)}).catch(m.default.toast_error_handler);(0,v.default)("请求中",_),e.stopPropagation()},1e3,!0),build_ta:function(){var e=this.props.card,t=this.context.auth_info;return(0,h.default)(e,t.u)},render:function(){var e=this.props,t=e.card,a=e.cursor,r=e.no_icon,s=(this.context.auth_info,a.get()),n=s.sub_data;return 0==t.dist?l.default.createElement("span",null):n&&n.is_subbed?l.default.createElement("button",{className:"order_btn",onClick:this.sub},!r&&l.default.createElement("span",{className:"glyphicon glyphicon-minus"}),"取消"):l.default.createElement("button",{className:"order_btn",onClick:this.sub},!r&&l.default.createElement("span",{className:"glyphicon glyphicon-plus"}),"订阅")}})},1391:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o,i,u=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),c=a(1),d=r(c),p=a(17),f=r(p),m=a(15),b=(r(m),a(76)),h=(r(b),a(50)),_=(r(h),a(46)),v=(r(_),a(75)),g=(r(v),a(281)),y=r(g),x=a(113),E=(r(x),a(117)),N=a(1129),j=r(N),P=a(116),T=r(P);t.default=e.exports=(i=o=function(e){function t(){var e,a,r,l;s(this,t);for(var o=arguments.length,i=Array(o),u=0;u<o;u++)i[u]=arguments[u];return a=r=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.article_list=f.default.debounce(function(e){r.props.cursor.select("tab_manager","current_tab").set(0)},1e3,!0),r.sub_list=f.default.debounce(function(){r.props.cursor.select("tab_manager","current_tab").set(1)},1e3,!0),r.subbed_list=f.default.debounce(function(){r.props.cursor.select("tab_manager","current_tab").set(2)},1e3,!0),l=a,n(r,l)}return l(t,e),u(t,[{key:"build_name",value:function(){return 0==this.props.card.dist?"我":this.props.card.name}},{key:"build_ta",value:function(){var e=this.props.card,t=this.context.auth_info;return(0,y.default)(e,t.u)}},{key:"render",value:function(){console.log(this.context);var e=this.props,t=e.card,a=(e.sub_number,e.sub_data,e.cursor),r=(this.context.auth_info,this.props.tab_manager.current_tab||0);(r<0||r>2)&&(r=0);var s=0==t.dist?"我":this.build_ta(),n=T.default.getCareer(this.props.card);return d.default.createElement("div",null,d.default.createElement("div",{className:"p-x-10 p-y-10"},d.default.createElement("div",{className:"pull-right"},d.default.createElement(j.default,{card:t,cursor:a})),d.default.createElement("div",{className:"clearfix"}),d.default.createElement("img",{className:"img-thumbnail img-circle center-block",style:(0,E.square)(64),src:t.avatar}),d.default.createElement("div",null,d.default.createElement("div",{className:"text-center"},t.name,"的专栏"),d.default.createElement("div",{className:"text-center small"},n,1==t.judge&&d.default.createElement("span",{className:"add_v_img"})))),d.default.createElement("table",{className:"table table-bordered text-center",style:k.table},d.default.createElement("tbody",null,d.default.createElement("tr",null,d.default.createElement("td",{onClick:this.article_list},d.default.createElement("div",null,this.props.feed_info.article||0),d.default.createElement("div",{className:0==r?"text-info small":"text-light small"},"专栏文章")),d.default.createElement("td",{onClick:this.sub_list},d.default.createElement("div",null,this.props.sub_number.sub_count||0),d.default.createElement("div",{className:1==r?"text-info small":"text-light small"},s,"的订阅")),d.default.createElement("td",{onClick:this.subbed_list},d.default.createElement("div",null,this.props.sub_number.subbed_count),d.default.createElement("div",{className:2==r?"text-info small":"text-light small"},s,"的读者"))))))}}]),t}(d.default.Component),o.contextTypes={auth_info:d.default.PropTypes.object},i);var k={table:{marginBottom:0,tableLayout:"fixed"}}},703:function(e,t,a){"use strict";function r(e,t){var a={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a}var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},n=a(15),l=a(75),o=a(46),i=a(1),u=a(981),c=a(1128),d=a(1391),p=a(982),f=a(165),m=a(270),b=i.createClass({displayName:"App",contextTypes:{auth_info:i.PropTypes.object,fconf:i.PropTypes.object},loadMoreArticle:function(){var e=this,t=this.context,a=t.auth_info,r=t.fconf;this.refs.article_loader.bindRequest(function(){var t=r.online_url+"feed/v3/user_article?"+n.stringify(s({u2:e.props.card.id,page:e.nextArticlePage},a));return fetch(t).then(l.parse_online_json).then(function(t){e.nextArticlePage++;var a=e.props.cursor.select("feeds");a.select("remain").set(t.remain),a.select("feeds").concat(t.feeds)})})},loadMoreSub:function(){var e=this,t=this.context,a=t.auth_info,r=t.fconf;this.refs.sub_loader&&this.refs.sub_loader.bindRequest(function(){var t=r.online_url+"feed/v3/sub_get?"+n.stringify(s({u2:e.props.card.id},a));return fetch(t).then(l.parse_online_json).then(function(t){e.nextSubPage++,e.props.cursor.select("sub_users").set(t)})})},loadMoreSubbed:function(){var e=this,t=this.context,a=t.auth_info,r=t.fconf;this.refs.subbed_loader.bindRequest(function(){var t=r.online_url+"feed/v3/subbed_users?"+n.stringify(s({sub_id:e.props.card.id,detail:1,page:e.nextSubbedPage},a));return fetch(t).then(l.parse_online_json).then(function(t){e.nextSubbedPage++,e.props.cursor.select("sub_number").select("subbed_users").concat(t.subbed_users)})})},lfansFeed:function(){o("/article/detail?fid=18859948","查看全文","fetch")},componentDidMount:function(){this.nextArticlePage=1,this.nextSubPage=1,this.nextSubbedPage=1},render:function(){var e=this,t=this.props.card,a=this.props,s=(a.feeds,r(a,["feeds"])),n=0==t.dist?"我":t.name,l=this.props.tab_manager.current_tab||0;(l<0||l>2)&&(l=0);var o={};0==l?(o.action=this.loadMoreArticle,o.has_more=this.props.feeds.remain>0,o.loader=i.createElement(f,{ref:"article_loader",reload:this.loadMoreArticle,cursor:this.props.cursor.select("article_loading_status")})):1==l?(o.action=this.loadMoreSub,o.has_more=this.props.sub_number.sub_count>this.props.sub_users.sub_users.length,o.loader=i.createElement(f,{ref:"sub_loader",reload:this.loadMoreSub,cursor:this.props.cursor.select("sub_loading_status")})):2==l&&(o.action=this.loadMoreSubbed,o.has_more=this.props.sub_number.subbed_count>this.props.sub_number.subbed_users.length,o.loader=i.createElement(f,{ref:"subbed_loader",reload:this.loadMoreSubbed,cursor:this.props.cursor.select("subbed_loading_status")}));var b=[];b.push(i.createElement("div",{className:"panel-heading"},i.createElement("div",{className:"text-muted"},"专栏文章共",this.props.feed_info.article,"篇"))),b.push(i.createElement("ul",{className:"list-group"},this.props.feeds.feeds.map(function(t,a){return i.createElement(c,{key:t.id,feed:t,addTitle:!0,cursor:e.props.cursor.select("feeds","feeds",a),card:e.props.card,sub_data:e.props.sub_data,sub_number:e.props.sub_number})})));var _=i.createElement("div",{className:"panel panel-default",style:0==l?h.show:h.hide}," ",b," ");b=[],b.push(i.createElement("div",{className:"panel-heading"},i.createElement("div",{className:"text-muted"},n,this.props.sub_number.sub_count?"共订阅了"+this.props.sub_number.sub_count+"人":"没有订阅专栏"))),this.props.sub_number.sub_count>0&&b.push(i.createElement("ul",{className:"list-group"},this.props.sub_users.sub_users.map(function(e){return i.createElement(m,{key:e.mmid,contact:e})})));var v=i.createElement("div",{className:"panel panel-default",style:1==l?h.show:h.hide}," ",b," ");b=[],b.push(i.createElement("div",{className:"panel-heading"},i.createElement("div",{className:"text-muted"},this.props.sub_number.subbed_count,"人已订阅"))),b.push(i.createElement("ul",{className:"list-group"},this.props.sub_number.subbed_users.map(function(e){return i.createElement(m,{key:e.mmid,contact:e})})));var g=i.createElement("div",{className:"panel panel-default",style:2==l?h.show:h.hide}," ",b," ");return i.createElement("div",null,i.createElement(u,{title:t.name+"的专栏"}),i.createElement(d,s),i.createElement(p,{loadMore:o.action,hasMore:o.has_more,loader:o.loader},_,v,g))}}),h={show:{display:"block",marginTop:0},hide:{display:"none"}};e.exports=b}});