webpackJsonp([48],{1142:function(e,t,a){"use strict";var n=a(17);e.exports.generateCell=function(e){return{avatar:e.avatar.length>0?e.avatar:"/static/images/mailogo.png",line1:e.profession_name+(e.major_name&&e.major_name.length>0?"|"+e.major_name:e.major_name),line2:e.desc,selected:e.enabled,profession:e.profession,major:e.major}},e.exports.isFollowed=function(e,t,a){if(e&&e.length>0){var r=n.find(e,function(e){return e.id==t});if(r&&r.majors&&r.majors.length>0){return!!n.find(r.majors,function(e){return e.id==a})}}return!1}},1424:function(e,t,a){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},r=a(984),i=a(47),o=function(e){return e&&e.__esModule?e:{default:e}}(i),s=a(1),l=a(17),c=a(15),d=(a(985)("app"),a(991),a(90)),f=a(75),p=a(114),u=a(1004),m=a(41),h=a(115).launch_webview,_=a(46),g=a(116),v=a(168),x=a(999),y=a(1005),E=y.showInputPanel,b=y.clearInput;e.exports=s.createClass({displayName:"exports",mixins:[m],contextTypes:{auth_info:s.PropTypes.object,fconf:s.PropTypes.object,env:s.PropTypes.object},getInitialState:function(){return{expand_txt:null,line_clamp:7,showInput:!1}},componentDidMount:function(){window.onInputFinished=y.onInputFinished,this.checkExpandTxt()},checkExpandTxt:function(){var e=this.props.feed,t=this.getCoordinates(this.refs.txt_wrapper),a=this.getCoordinates(this.refs.txt),n=e.feed.summary||e.feed.richtext||e.feed.text;t<a&&this.setState({expand_txt:n.length<250?"展开":"全文"})},getCoordinates:function(e){return o.default.findDOMNode(e).getBoundingClientRect().height},componentWillUnmount:function(){window.onInputFinished=null},showFeedDetail:l.debounce(function(){var e=this.props.feed,t=this.context,a=t.auth_info,r=t.fconf,i=e.feed.text,o=i.length>250&&"operation_topic"!=e.feed.data_str;if(a.u>0){if(o?_("/article/detail?fid="+e.fid,"查看全文","fetch"):x(e.fid),e.feed.search_qs&&e.feed.search_order){var s=r.online_url+"search/web/s_pb?"+c.stringify(n({srcu:a.u,type:"feed",targetid:e.feed.id,order:e.feed.search_order,qs:e.feed.search_qs},a));fetch(s)}}else o?_("/article/detail?fid="+e.fid,"查看全文","fetch"):location.href="/web/feed_detail?fid="+e.fid},1e3,!0),like:function(e){var t=this;e.stopPropagation();var a=this.props,r=a.feed,i=a.cursor,o=this.context,s=o.auth_info,l=o.fconf;if(i&&s.u>0)try{var d=r.me_like;this.props.cursor.select("me_like").set(1==d?0:1);var p=r.feed.likes;this.props.cursor.select("feed","likes").set((1==d?-1:1)+p);var u=l.online_url+"feed/v3/like?"+c.stringify(n({fid:this.props.feed.fid,like:1==d?0:1},s));fetch(u).then(f.parse_online_json).catch(f.toast_error_handler).catch(function(e){t.props.cursor.select("me_like").set(d),t.props.cursor.select("feed","likes").set(p)})}catch(e){alert(e)}else s.u<0&&h()},gotoDetail:function(e){this.refs.avatar.gotoDetail(e)},spreadComment:function(e,t){var a=this,r=this.context,i=r.auth_info,o=r.fconf,s=this.props.feed,l="live_video_"+s.fid;if(!e)return void toast("回复内容不能为空");var d=new FormData;d.append("fid",s.fid),d.append("text",e),d.append("at_user_info",t);var u=o.online_url+"feed/v3/comment_spread?"+c.stringify(n({},i)),m=fetch(u,{method:"post",body:d}).then(f.parse_online_json).then(function(t){b(l),a.props.cursor.select("spread_feed","feed").set({summary:e})}).catch(f.toast_error_handler);p("请求中...",m)},reply:function(e){e.stopPropagation();var t=this.props.feed;if(window.MaiMai_Native.native_show_inputpanel){var a="live_video_"+t.fid,n=this.props.contact||t.contact;E("回复",a,this.spreadComment,"回复 "+n.name)}else this.replaceState({showInput:!this.state.showInput})},renderInputPanel:function(){if(this.context.env.from_pc){var e=this.props.feed,t=this.props.contact||e.contact,a="回复 "+t.name;return s.createElement("div",{className:this.state.showInput?"p-b":"hidden",style:{marginLeft:50},onClick:function(e){e.stopPropagation()}},s.createElement(u,{placeHolder:a,onClickSend:this.spreadComment,maxWord:250}))}},onExpandTxtClicked:function(e){e.stopPropagation(),"展开"==this.state.expand_txt?this.setState({expand_txt:null,line_clamp:0}):this.showFeedDetail()},renderExpandTxt:function(){var e=this.state.expand_txt;if(e)return s.createElement("div",{className:"text-info liveReply",onClick:this.onExpandTxtClicked},e)},render:function(){var e,t=this.state.line_clamp,a=this.props,n=a.feed,i=a.reply,o=this.props.contact||n.contact,l=g.getCareer(o);e=31!=n.feed.type&&l?" | "+l:"";var c=this.props.author_card&&0==this.props.author_card.dist&&this.props.author_card.id!=o.id&&!i&&0!=o.dist;return s.createElement("li",{className:"list-group-item clearfix",onClick:this.showFeedDetail},s.createElement("div",{className:"media"},s.createElement("div",{className:"media-left"},s.createElement(v,{ref:"avatar",customClass:"topic-avatar",card:o,image_id:this.props.image_id,onClick:this.gotoDetail})),s.createElement("div",{className:"media-body"},s.createElement("div",{className:"lineClamp1",style:{marginBottom:"6px"}},s.createElement("span",{className:"text-primary",onClick:this.gotoDetail},o.name),s.createElement("span",{className:"text-info small"},e),1==o.judge&&s.createElement("span",{className:"add_v_img"})),s.createElement("p",null,n.feed.crtime_string),s.createElement("p",{style:t>0?(0,r.textOverflow)(t):null,ref:"txt_wrapper"},s.createElement(d,{ref:"txt",text:n.feed.summary||n.feed.richtext||n.feed.text,support_dref:!0})),this.renderExpandTxt(),c&&s.createElement("span",{className:"text-info liveReply",onClick:this.reply},"回复"),this.props.children),s.createElement("div",{className:"media-right media-middle text-center"},s.createElement("div",{style:{width:"34px"},onClick:this.like},this.props.cursor&&s.createElement("img",{src:n.me_like?"/static/images/ding2.png":"/static/images/ding1.png",style:w.img}),s.createElement("p",{className:"text-light small"},n.feed.likes>0&&n.feed.likes)))),i&&s.createElement("div",{className:"lightBlueBg p-x-10 p-y-10 m-l-48"},s.createElement("div",{className:"media-body media-middle small text-muted"},s.createElement("span",{className:"text-primary"},i.contact.name),"回复:",s.createElement(d,{text:i.feed.summary||i.feed.richtext||i.feed.text,support_dref:!0}))),c&&this.renderInputPanel())}});var w={heading:{marginTop:-10,marginLeft:-20,marginRight:-20},like:{marginBottom:3},avatarSize:{width:42,height:42,WebkitBorderRadius:"2px"},img:{width:"14px",height:"14px",marginBottom:"4px"},tableCell:{display:"table-cell"},zanBox:{display:"table-cell",textAlign:"center",verticalAlign:"middle",width:50}}},708:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s,l,c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},d=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),f=a(1),p=n(f),u=a(75),m=n(u),h=a(76),_=(n(h),a(981)),g=n(_),v=a(15),x=n(v),y=a(1424),E=n(y),b=a(46),w=(n(b),a(117)),k=n(w),j=(a(113),a(115),a(165)),C=n(j),N=a(90),P=(n(N),a(986)),T=(n(P),a(1141)),O=(n(T),a(17)),I=n(O),M=a(170),D=(n(M),a(279)),q=(n(D),a(114)),B=n(q),F=a(988),R=(n(F),a(1142)),S=(n(R),a(1008)),A=n(S),H=a(993),L=n(H),W=a(982);t.default=e.exports=(l=s=function(e){function t(){var e,a,n,o;r(this,t);for(var s=arguments.length,l=Array(s),d=0;d<s;d++)l[d]=arguments[d];return a=n=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),n.doRequest=function(e,t,a){var r=n.context,i=r.auth_info,o=r.fconf;I.default.extend(t,i);var s=o.online_url+e+"?"+x.default.stringify(t),l=fetch(s,{credentials:"same-origin"}).then(m.default.parse_online_json).then(function(e){a(e)}).catch(m.default.toast_error_handler);(0,B.default)("设置中...",l)},n.loadMore=function(){try{var e=n.context.req,t=n.props,a=t.feeds,r=t.cursor,i=e.pathname+"?"+x.default.stringify(c({},e.query,{skip:a.length,jsononly:1}));fetch(i,{credentials:"same-origin"}).then(u.parse_online_json).then(function(e){e.data.feeds&&e.data.feeds.length>0?r.select("feeds").concat(e.data.feeds):r.select("end").set(1)}).catch(alert)}catch(e){alert(e)}},o=a,i(n,o)}return o(t,e),d(t,[{key:"renderHeader",value:function(){var e=this.props,t=e.tag_datas,a=(e.tags,e.white_list,e.topic_imgs),n=this.context;n.fconf,n.env;return p.default.createElement("div",{className:"media"},p.default.createElement("p",{className:"topicTitle"},t.name),t.description&&p.default.createElement("div",{className:"p-x-10 m-b"},p.default.createElement("div",null,p.default.createElement(L.default,{ref:"txt",text:t.description,support_dref:!0}))),a&&a.length>0&&p.default.createElement("div",{className:"m-b",style:{marginLeft:10}},p.default.createElement(A.default,{images:a})))}},{key:"render",value:function(){var e=this,t=this.props,a=t.tag_datas,n=t.feeds,r=(this.context.req,a.name);return p.default.createElement("div",null,this.renderHeader(),p.default.createElement(g.default,{title:r}),p.default.createElement(W,{hasMore:!this.props.end,loadMore:this.loadMore,loader:p.default.createElement(C.default,{ref:"loader",reload:this.loadMore,cursor:this.props.cursor.select("loading_status")})},p.default.createElement("div",{className:"panel panel-default"},p.default.createElement("ul",{key:"content-2",className:"list-group"},n.map(function(t,a){return p.default.createElement(E.default,{key:t.fid,feed:t,author_card:e.props.author_card,cursor:e.props.cursor.select("feeds",a)},p.default.createElement(A.default,{images:t.feed.pics,max_count:3,type_multi:!0}))})))))}}]),t}(p.default.Component),s.contextTypes={req:p.default.PropTypes.object,fconf:p.default.PropTypes.object,auth_info:p.default.PropTypes.object},l);k.default.Constants.large}});