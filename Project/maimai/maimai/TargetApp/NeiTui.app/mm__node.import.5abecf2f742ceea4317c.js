webpackJsonp([77],{1389:function(t,e,i){"use strict";var a=i(1),s=function(t){return t&&t.__esModule?t:{default:t}}(a),n=i(984);t.exports=s.default.createClass({displayName:"exports",onTagClicked:function(t){t.stopPropagation(),this.props.onTagClicked(this.props.tag.tag)},getInitialState:function(){return{}},onItemClicked:function(t){t.stopPropagation(),this.props.tag.weight>0&&this.props.onItemClicked(this.props.tag.tag,this.props.tag.weight)},componentDidMount:function(){this.refs.container.clientWidth!=this.state.containerWidth&&this.setState({containerWidth:this.refs.container.clientWidth})},componentDidUpdate:function(){this.refs.container.clientWidth!=this.state.containerWidth&&this.setState({containerWidth:this.refs.container.clientWidth})},renderAvatar:function(){if(this.props.tag.contacts&&this.props.tag.contacts.length>0){var t=this.props.tag.weight,e=this.props.tag.weight>3,i=0;this.props.tag.weight>0&&(i=this.props.tag.weight<=3?this.props.tag.weight:3);var a=this.state.containerWidth?this.state.containerWidth-175:140,n=a/this.props.maxWeight;n>20&&(n=20);var r=0;this.props.tag.weight>3&&(r=parseInt(n*(this.props.tag.weight-3)));var o=22*i+(e?20:0)+20+10+r;return s.default.createElement("div",{style:{height:"34px"}},s.default.createElement("span",{style:{padding:"0px 6px",top:"44px",width:o,background:"#daedfb",WebkitBorderRadius:"4px",position:"absolute"},onclick:this.onTagClicked},this.props.tag.contacts.slice(0,3).map(function(t){return s.default.createElement("img",{key:t.mmid,src:t.avatar,className:"tag-avatar-icon"})}),e&&s.default.createElement("span",{key:"more",style:{color:"white",marginTop:"7px",float:"left"}}," •••"),s.default.createElement("span",{key:"tips",className:"small",style:{float:"right",margin:"9px 3px 7px",color:"#008ce8"}},t)))}},render:function(){var t=0;return this.props.tag.weight>0&&(t=33),s.default.createElement("li",{className:"list-group-item p-y clearfix",ref:"container"},s.default.createElement("div",{className:"pull-right",style:r.button,onClick:this.onTagClicked},s.default.createElement("img",{style:{marginTop:t,width:16,height:16},src:this.props.praised?"/static/images/ding3.png":"/static/images/ding1.png"})),s.default.createElement("div",{style:(0,n.padding)("3px","0px","0px","0px"),onClick:this.onItemClicked},s.default.createElement("span",{style:r.tag},this.props.tag.tag),this.renderAvatar()))}});var r={tag:{fontSize:15},button:{WebkitBorderRadius:"16px",padding:"4px 2px 4px 4px",verticalAlign:"middle",width:"40px",textAlign:"center"},arrow:{width:"13px",height:"15px",marginTop:"11px"},arrow_hide:{width:"13px",height:"15px",marginTop:"11px",visibility:"hidden"}}},698:function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}var s=i(1),n=a(s),r=i(981),o=a(r),p=i(76),c=a(p),l=i(75),d=a(l),h=i(17),g=a(h),u=i(15),f=a(u),m=i(1389),x=a(m),w=i(46),v=a(w),_=i(113),k=i(41);t.exports=n.default.createClass({displayName:"exports",mixin:[k],contextTypes:{auth_info:n.default.PropTypes.object,fconf:n.default.PropTypes.object},onTagClicked:function(t){var e=0==this.props.card.dist;if(e||!(this.props.card.dist<3))return void(0,c.default)(e?"您不能赞自己的标签":"没有权限赞标签");this.toggleTag(t)},toggleTag:function(t){var e=this;this.toggleTagWithoutRequest(t);var i=g.default.contains(this.props.uinfo.praised,t),a=g.default.extend({u2:this.props.card.id,tag:t,cancel:i},this.context.auth_info),s=this.context.fconf,n=s.online_url+"feed/v3/praise_tag?"+f.default.stringify(a);fetch(n).then(d.default.parse_online_json).then(function(){(0,_.sendWebViewBroadcast)("merge_user_info",e.props.cursor.select("uinfo").get())}).catch(function(){e.toggleTagWithoutRequest(t)})},toggleTagWithoutRequest:function(t){var e,i=this,a=g.default.contains(this.props.uinfo.praised,t),s=[];if(this.props.uinfo.tag_weights[t]&&(s=this.props.uinfo.tag_weights[t].contacts||[]),a){var n=g.default.indexOf(this.props.uinfo.praised,t);this.props.cursor.select("uinfo","praised").splice([n,1]),e=parseInt(this.props.uinfo.tag_weights[t].weight)-1,s=s.filter(function(t){return t.mmid!=i.props.mycard.mmid})}else this.props.cursor.select("uinfo","praised").concat([t]),e=this.props.uinfo.tag_weights[t]?parseInt(this.props.uinfo.tag_weights[t].weight)+1:1,s.unshift({mmid:this.props.mycard.mmid,avatar:this.props.mycard.avatar});this.props.cursor.select("uinfo","tag_weights",t).set({tag:t,weight:e,contacts:s})},onItemClicked:function(t,e){var i="/contact/tag_contacts_richcards?"+f.default.stringify({u2:this.props.card.mmid,tag:t,weight:e});(0,v.default)(i,t,"fetch")},render:function(){var t=this,e=0==this.props.card.dist,i=!e&&this.props.card.dist<3,a=3;return g.default.forEach(this.props.uinfo.tag_weights,function(t){parseInt(t.weight)>a&&(a=t.weight)}),a++,n.default.createElement("div",null,n.default.createElement(o.default,{title:this.props.card.name+"的标签"}),n.default.createElement("div",{className:"panel panel-default"},n.default.createElement("div",{className:"panel-heading clearfix"},n.default.createElement("span",{className:"pull-left"},"共",this.props.uinfo.weibo_tags.length,"个标签")),n.default.createElement("ul",{className:"list-group"},this.props.uinfo.weibo_tags.map(function(e){var s=t.props.uinfo.tag_weights[e];s||(s={tag:e,weight:0});var r=g.default.contains(t.props.uinfo.praised,e);return n.default.createElement(x.default,{tag:s,key:e,maxWeight:a,canPraisedTag:i,praised:r,onTagClicked:t.onTagClicked,onItemClicked:t.onItemClicked})}))))}})}});