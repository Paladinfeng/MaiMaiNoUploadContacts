webpackJsonp([304],{960:function(e,i,t){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function o(e,i){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?e:i}function r(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i)}Object.defineProperty(i,"__esModule",{value:!0});var l=function(){function e(e,i){for(var t=0;t<i.length;t++){var a=i[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(i,t,a){return t&&e(i.prototype,t),a&&e(i,a),i}}(),d=t(1),s=a(d),u=t(47),c=a(u),p=t(981),m=a(p),f=t(76),v=a(f),_=function(e){function i(e){n(this,i);var t=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return t.swipeOnChangeIndex=function(e,i){e>i?t.playNext():t.playPrev()},t.formatTime=function(e){var i=parseInt(e/60).toString(),t=(e%60).toString();return i+":"+(t>9?t:"0"+t)},t.willAppear=function(){t.setState({disappear:!1}),window&&window.MaiMai_Native&&window.MaiMai_Native.native_play_audio_setWebViewController&&window.MaiMai_Native.native_play_audio_setWebViewController()},t.willDisappear=function(){t.setState({disappear:!0}),window&&window.MaiMai_Native&&window.MaiMai_Native.play_audio_hide&&t.state.playing&&window.MaiMai_Native.native_play_audio_hide(!1)},t.nativePlayCallback=function(e){if(e&&e.length>0&&t.props){var i=JSON.parse(e),a=t.state.slideIndex,n=t.props.eggs,o=n[a],r=n[a+1],l=i.isPlaying,d=i.currentSecond,s=i.isHide,u=!l,p=c.default.findDOMNode(t.refs.timeLine);if(o){var m=i.playItem,f=i.lastPlayItem,v=i.isEnd;if(m.id==o.id){u=!0;var _=!l&&t.state.waiting;v&&(l=!1,d=0);var w=t.getTimeLinePosition(m.duration,parseInt(d),p);t.setState({currentTime:d,timeLinePosition:w,waiting:_}),l!=t.state.play&&(t.setState({play:l}),l&&t.setState({init:!0}))}else if(f.id==o.id&&m.id==r.id){u=!0;var y=t.getTimeLinePosition(m.duration,parseInt(d),p);t.setState({currentTime:d,slideIndex:a+1,timeLinePosition:y}),l!=t.state.play&&t.setState({play:l})}}window&&window.MaiMai_Native&&window.MaiMai_Native.native_play_audio_hide&&(t.state.disappear||s==u||window.MaiMai_Native.native_play_audio_hide(u))}},t.nativeErrorCallback=function(){t.setState({currentTime:0,play:!1,timeLinePosition:"-100%"}),(0,v.default)("播放错误，请检查网络")},t.nativeInitPlay=function(){return!!(window&&window.MaiMai_Native&&window.MaiMai_Native.native_play_audio_init)&&(window.MaiMai_Native.native_play_audio_init(),!0)},t.initListCallback=function(){window.MaiMai_Native.native_play_audio_play()},t.nativePlay=function(e,i){if(!window||!window.MaiMai_Native||!window.MaiMai_Native.native_play_audio_list)return!1;if(t.state.init)i?(t.onWaiting(),window.MaiMai_Native.native_play_audio_play()):window.MaiMai_Native.native_play_audio_pause();else{t.setState({play:i});var a=t.props.eggs;window.MaiMai_Native.native_play_audio_list(JSON.stringify({playlist:a,currentIndex:e}),"initListCallback"),t.onWaiting(),t.setState({init:!0})}return!0},t.nativeStartPlay=function(e){return!!(window&&window.MaiMai_Native&&window.MaiMai_Native.native_play_audio_list)&&(window.MaiMai_Native.native_play_audio_item(JSON.stringify({index:e})),!0)},t.nativePlayTo=function(e){window&&window.MaiMai_Native&&window.MaiMai_Native.native_play_audio_seekTo&&window.MaiMai_Native.native_play_audio_seekTo(JSON.stringify({second:e}))},t.play=function(e,i){if(!t.nativePlay(e,i)){var a=t.props.eggs,n=a[e],o=c.default.findDOMNode(t.refs.audioWrapper);if(t.setState({play:i}),t.audio)try{t.audio.paused?t.audio.play():t.audio.pause()}catch(e){t.onAudioError()}else{t.audio&&o.removeChild(t.audio);var r=new Audio;o.appendChild(r),t.audio=r,r.src=n.url,r.play(),r.addEventListener("waiting",t.onWaiting),r.addEventListener("canplay",t.onCanPlay),r.addEventListener("timeupdate",t.onAudioTimeUpdate),r.addEventListener("ended",t.onAudioEnd),r.addEventListener("error",t.onAudioError)}}},t.onWaiting=function(){t.setState({waiting:!0})},t.onCanPlay=function(){t.setState({waiting:!1})},t.onAudioTimeUpdate=function(){if(t.audio){var e=t.props.eggs,i=e[t.state.slideIndex],a=c.default.findDOMNode(t.refs.timeLine),n=t.getTimeLinePosition(i.duration,parseInt(t.state.currentTime),a);t.setState({currentTime:t.audio.currentTime,timeLinePosition:n})}},t.onAudioEnd=function(){t.audio&&(t.audio.currentTime=0,t.setState({currentTime:0,play:!1,timeLinePosition:"-100%"}))},t.onAudioError=function(){if(t.audio){t.audio.removeEventListener("waiting",t.onWaiting),t.audio.removeEventListener("canplay",t.onCanPlay),t.audio.removeEventListener("timeupdate",t.onAudioTimeUpdate),t.audio.removeEventListener("ended",t.onAudioEnd),t.audio.removeEventListener("error",t.onAudioError);c.default.findDOMNode(t.refs.audioWrapper).removeChild(t.audio),t.audio=null}t.setState({currentTime:0,play:!1,timeLinePosition:"-100%"}),(0,v.default)("播放错误，请检查网络")},t.getTimeLinePosition=function(e,i,t){var a=t.clientWidth;return-(a-a/e*i)+"px"},t.playFast=function(e){var i=t.state.currentTime+15>e?e:t.state.currentTime+15;t.audio?t.audio.currentTime=i:t.nativePlayTo(i),t.setState({currentTime:i})},t.playRewind=function(){var e=t.state.currentTime-15<=0?0:t.state.currentTime-15;t.audio?t.audio.currentTime=e:t.nativePlayTo(e),t.setState({currentTime:e})},t.startPlay=function(e){if(t.setState({slideIndex:e,play:!1,currentTime:0,timeLinePosition:"-100%"}),!t.nativeStartPlay(e)){var i=c.default.findDOMNode(t.refs.audioWrapper);t.audio&&(t.audio.removeEventListener("waiting",t.onWaiting),t.audio.removeEventListener("canplay",t.onCanPlay),t.audio.removeEventListener("timeupdate",t.onAudioTimeUpdate),t.audio.removeEventListener("ended",t.onAudioEnd),t.audio.removeEventListener("error",t.onAudioError),i.removeChild(t.audio)),t.audio=null}},t.state={slideIndex:0,play:!1,currentTime:0,timeLinePosition:"-100%",waiting:!1,init:!1,disappear:!1},t}return r(i,e),l(i,[{key:"componentDidMount",value:function(){window.sendPlayInfo=this.nativePlayCallback,window.sendPlayError=this.nativeErrorCallback,window.willAppear=this.willAppear,window.willDisappear=this.willDisappear,window.initListCallback=this.initListCallback,this.willAppear()}},{key:"componentWillUnmount",value:function(){window.sendPlayInfo=null,window.sendPlayError=null,window.willAppear=null,window.willDisappear=null,window.initListCallback=null}},{key:"render",value:function(){var e=this,i=this.props,t=i.eggs,a=i.title,n=this.state.slideIndex,o=parseInt(this.state.currentTime),r=t[n];return s.default.createElement("div",null,s.default.createElement(m.default,{title:"音频"}),s.default.createElement("div",{className:"p-y-25"},s.default.createElement("div",{style:w.root},s.default.createElement("div",{key:"audio",className:"p-x-20 text-center"},s.default.createElement("div",{className:"p-relative"},s.default.createElement("div",{className:"font-0",style:{visible:"hidden",opacity:0}},s.default.createElement("img",{className:"w-100",src:r.img_big})),s.default.createElement("div",{className:"course_play_item_cur"},s.default.createElement("img",{className:"w-100",src:r.img_big})))))),s.default.createElement("div",{className:"p-x text-center"},s.default.createElement("div",{className:"font-18 font-bold m-b-10"},a),s.default.createElement("div",{className:"text-info course_play_text_info"},r.title)),s.default.createElement("div",{className:"course_play_progress"},s.default.createElement("div",{className:"media-left p-r-0 media-middle"},s.default.createElement("div",{className:"course_play_time text-right"},this.formatTime(o))),s.default.createElement("div",{className:"media-body media-middle"},s.default.createElement("div",{className:"course_play_time_line m-x-5",ref:"timeLine"},s.default.createElement("div",{className:"course_play_move_line",style:{left:this.state.timeLinePosition}}))),s.default.createElement("div",{className:"media-right p-l-0 media-middle"},s.default.createElement("div",{className:"course_play_time"},this.formatTime(r.duration)))),s.default.createElement("div",{className:"course_play_oper"},s.default.createElement("div",{onClick:this.playRewind,className:"course_play_rewind"},s.default.createElement("span",{className:"course_detail_rewind"})),s.default.createElement("div",{className:"course_play_pause",onClick:function(){return e.play(n,!e.state.play)}},this.state.waiting&&s.default.createElement("span",{className:"course_detail_waiting"}),!this.state.waiting&&s.default.createElement("span",{className:this.state.play?"course_detail_pause":"course_detail_play"})),s.default.createElement("div",{onClick:function(){return e.playFast(r.duration)}},s.default.createElement("span",{className:"course_detail_fast"}))),s.default.createElement("div",{className:"audioWrapper",ref:"audioWrapper"}))}}]),i}(s.default.Component);_.contextTypes={req:s.default.PropTypes.object,fconf:s.default.PropTypes.object,env:s.default.PropTypes.object,auth_info:s.default.PropTypes.object};var w={root:{zIndex:"2",paddingLeft:75,paddingRight:75}};i.default=e.exports=_}});