webpackJsonp([10],{1471:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),s=n(1),l=function(e){return e&&e.__esModule?e:{default:e}}(s);t.default=e.exports=function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),i(t,[{key:"render",value:function(){var e=this;return l.default.createElement("div",{className:"option_dialog"},l.default.createElement("div",{className:"title borderBottom"},this.props.title),this.props.options.map(function(t,n){return l.default.createElement("div",{key:n,className:"option borderBottom",onClick:function(){return e.props.onSelected(n)}},t)}))}}]),t}(l.default.Component)},301:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s,l,u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),f=n(75),d=n(981),p=a(d),h=n(1471),m=a(h),v=n(77),x=a(v),y=n(1),b=a(y),g=n(17),_=a(g),E=n(164),S=n(46),N=a(S),C=n(15),O=a(C),I=n(169),k=a(I),w=n(114),j=a(w),P=n(76),T=a(P);t.default=e.exports=(l=s=function(e){function t(e){o(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={focus:!1,relationIndex:0,expIndex:-1},n}return i(t,e),c(t,[{key:"onChooseRelation",value:function(){var e=this;if(!this.props.re.relation_map)return void(0,T.default)("您不能点评此用户");var t=[],n=_.default.map(this.props.re.relation_map,function(e,n){return t.push(n),e.text}),a=.618*(0,k.default)().height;x.default.popup(b.default.createElement("div",{style:{maxHeight:a,overflow:"auto"}},b.default.createElement(m.default,{title:"请选择关系",options:n,onSelected:function(n){if(x.default.dismiss(),t[n]!=e.state.relationIndex){var a=e.props.re.second_step[e.props.re.relation_map[t[n]].second_step],o=-1;a&&1==a.length&&(o=0),e.setState({relationIndex:t[n],expIndex:o})}}})))}},{key:"onChooseCommonExp",value:function(){var e=this,t=this.getSecondStepOptions();if(t){var n=.618*(0,k.default)().height;x.default.popup(b.default.createElement("div",{style:{maxHeight:n,overflow:"auto"}},b.default.createElement(m.default,{title:"请选择经历",options:t,onSelected:function(t){x.default.dismiss(),e.setState({expIndex:t})}})))}}},{key:"get_length",value:function(e){if(!e)return 0;e.replace(/ /g,"");var t=e.match(/([\uD800-\uDBFF][\uDC00-\uDFFF])/g);return e.length-(t?t.length:0)}},{key:"onSubmit",value:function(){var e=this.refs.textarea.value||"";e=e.replace(/\n\s*\n\s*\n/g,"\n\n");var t=this.get_length(e);if(this.state.relationIndex<=0)return void(0,T.default)("请选择好友关系");if(this.getSecondStepOptions()&&this.state.expIndex<0)return void(0,T.default)("请选择共同经历");if(!this.canComment())return void("education"==this.getSecondStepIndexName()?(0,T.default)("对方暂无教育经历，无法点评"):(0,T.default)("对方暂无工作经历，无法点评"));if(null==e||t<24||t>1500)return void(0,T.default)("点评字数限24-1500字");if(this.props.inviteMode){var n=JSON.stringify({u:this.context.req.query.u,text:e,rel:this.state.relationIndex,exp:this.getChoosedExpName()}),a="http://acc.maimai.cn/reg?"+O.default.stringify({u:this.context.req.query.u,fr:"invite_comment",payload:n});window.open(a)}else{var o=fetch(this.context.fconf.online_url+"evaluation/contact_add?"+O.default.stringify(u({},this.context.auth_info,{u2:this.props.card.id,text:e,fr:this.context.req.query.fr?this.context.req.query.fr:"normal",relation:this.state.relationIndex,experience:this.getChoosedExpName()})),{credentials:"same-origin"}).then(f.parse_online_json).then(function(e){(0,N.default)("../comment_detail/"+e.id+"?from=add","点评详情","fetch"),(0,T.default)("点评发布成功"),history.length>1?history.back():(0,E.closePage)("",!0)}).catch(f.toast_error_handler);(0,j.default)("正在发布点评",o)}}},{key:"getTitle",value:function(){var e;return this.state.relationIndex>0&&(e=this.props.re.relation_map[this.state.relationIndex].q),e||(e="综合评价"+this.props.card.name),e}},{key:"getRelationName",value:function(){if(this.state.relationIndex>0)return this.props.re.relation_map[this.state.relationIndex].text}},{key:"getSecondStepIndexName",value:function(){if(this.state.relationIndex>0)return this.props.re.relation_map[this.state.relationIndex].second_step}},{key:"getSecondStepOptions",value:function(){var e=this.getSecondStepIndexName();return this.props.re.second_step[e||""]}},{key:"getChoosedExpName",value:function(){var e=this.getSecondStepOptions();if(this.state.expIndex>=0)return e[this.state.expIndex]}},{key:"canComment",value:function(){return!(this.state.relationIndex>0&&!this.getSecondStepOptions()&&this.getSecondStepIndexName())}},{key:"render",value:function(){var e,t=this,n=!this.state.focus&&!this.state.input,a=this.getTitle();return this.canComment()||(e="education"==this.getSecondStepIndexName()?"对方暂无教育经历，无法点评":"对方暂无工作经历，无法点评"),b.default.createElement("div",{className:"add_comment"},b.default.createElement(p.default,{title:"给"+this.props.card.name+"点评"}),b.default.createElement("div",{className:"comtBox2"},b.default.createElement("div",{className:"comtRelation comtChoose clearfix",onClick:this.onChooseRelation.bind(this)},b.default.createElement("span",{className:"chooseTitle"},"你和",this.props.ta,"的关系"),b.default.createElement("span",{className:"chooseDetail"},this.getRelationName()||"请选择关系")),this.getSecondStepIndexName()&&b.default.createElement("div",{className:"comtChoose clearfix",onClick:this.onChooseCommonExp.bind(this)},b.default.createElement("span",{className:"chooseTitle"},"选择共同经历"),!e&&b.default.createElement("span",{className:"chooseDetail"},this.getChoosedExpName()||"请选择经历"),e&&b.default.createElement("span",{className:"chooseDetail"},e))),b.default.createElement("div",{className:"comtTit2"},b.default.createElement("span",{className:"stressText"},a),b.default.createElement("span",{className:"detail"},"(建议结合具体事例点评)")),b.default.createElement("div",{className:"comtConBox"},n&&b.default.createElement("div",{onClick:function(){t.setState({focus:!0}),t.refs.textarea.focus()},className:"comment_tips"},"你可以从以下方面来点评（限24-1500字）：",b.default.createElement("br",null),b.default.createElement("br",null),"1.",this.props.ta,"在人品、专长、潜力方面给你的感受或体会",b.default.createElement("br",null),b.default.createElement("br",null),"2.共同经历中他值得称赞的典型事迹",b.default.createElement("br",null),b.default.createElement("br",null),"3.与",this.props.ta,"合作的整体感觉"),b.default.createElement("textarea",{ref:"textarea",defaultValue:this.state.value,onChange:function(){return t.setState({input:t.refs.textarea.value})},onfocus:function(){return t.setState({focus:!0})},onblur:function(){return t.setState({focus:!1})},className:"comtCon"})),b.default.createElement("div",{className:"m-a"},b.default.createElement("div",{className:"btn btn-lg btn-secondary btn-block m-t",onClick:this.onSubmit.bind(this)},"发布点评")))}}]),t}(b.default.Component),s.contextTypes={fconf:b.default.PropTypes.object,req:b.default.PropTypes.object,auth_info:b.default.PropTypes.object},l)}});