webpackJsonp([32],{1463:function(e,t,a){"use strict";var r=(a(984),a(1026)),s=a(1),i=(a(17),a(15),a(279)),n=(a(90),a(41)),o=(a(115).launch_webview,a(46),a(116)),c=a(168),l=a(282).format_for_message,d=(a(171),a(281),a(1464));e.exports=s.createClass({displayName:"exports",mixins:[n],contextTypes:{auth_info:s.PropTypes.object,fconf:s.PropTypes.object},addFriend:function(e){var t=this;e.stopPropagation();var a=this.context,s=a.auth_info,i=a.fconf,n=s.u;(0,r.tryAddFriend)("",s,i,n,this.props.card.id,"visit_history",{mycard:this.props.mycard,jump_to_add_fr_requested:!0}).then(function(e){e.allow&&t.props.cursor.select("frMeWantHe").set(!0)}).catch(function(e){console.log(e)})},render:function(){var e=this,t=this.props.card,a=t.card,r=t.cmf,n=t.cmf_count,m=t.visit_time,u=t.frHeWantMe,f=t.frMeWantHe,p=t.srctype,v=o.getCareer(a),_=o.getDetailRelationDesc(a),h=n&&parseInt(n)>0,E=i(a.profession,a.major,"｜"),y=d.parsesrcType(p),g={line1:{marginBottom:h?2:5},sentence:{paddingLeft:"61px",fontSize:"13px",color:"#393D40",marginTop:"5px"},sentenceLogo:{fontSize:0,height:"15px",width:"15px",marginRight:"5px",display:"inline-block",verticalAlign:"middle"}};return s.createElement("li",{className:"list-unstyled p-y-10 border-bottom-e0 p-x clearfix",onClick:function(t){e.refs.avatar.gotoDetail(t)}},s.createElement("div",null,s.createElement("div",{className:"media-left"},s.createElement(c,{ref:"avatar",customClass:"contact_avatar",card:a,image_id:this.props.image_id})),s.createElement("div",{className:"media-body"},s.createElement("div",{className:"font-15 m-r-10"},a.name,s.createElement("div",{className:"pull-right text-muted small"},m&&l(new Date(m).getTime()/1e3))),!f&&!u&&1!=a.dist&&s.createElement("div",{className:"pull-right voidDeepBlueBtnG btn-radius-20 small",onClick:this.addFriend},"+好友"),u&&1!=a.dist&&s.createElement("div",{className:"pull-right voidDeepBlueBtnG2 btn-radius-20 small",onClick:function(t){t.stopPropagation(),e.props.acceptFriend(a.mmid,1)}},"通过申请"),f&&s.createElement("div",{className:"pull-right voidDeepBlueBtnG2 btn-radius-20 small"},"已申请"),s.createElement("div",{style:g.line1,className:"text-info small m-t-5"},v,1==a.judge&&s.createElement("span",{className:"add_v_img"}),1==a.mem_st&&this.renderMember(a)),s.createElement("div",{className:"text-info small"},1==a.dist?this.renderSubFriend(y,_,E):this.renderSubNotFriend(y,_,E,n,r))),a.one_sentence&&1==a.mem_st&&s.createElement("div",{className:"lineClamp2",style:g.sentence},s.createElement("span",{style:g.sentenceLogo},s.createElement("img",{src:"/static/images/xgb.png",className:"mx-w-100"})),a.one_sentence)))},renderSubFriend:function(e,t,a){return e&&e.length>0?e:t||a},renderSubNotFriend:function(e,t,a,r,i){if(r<5&&e&&e.length>0){var n=[];return n.push(e),t&&"undefined"!=t&&n.push("，"+t),n}var o=r&&parseInt(r)>0,n=[];return o?(n.push(i.map(function(e){return s.createElement("img",{className:"friend_img",src:e.avatar})})),n.push(s.createElement("span",{className:"friend_tips"},r,"个共同好友",t&&"，"+t)||t||a),n):t||a},renderMember:function(e){return 1==e.mem_id||2==e.mem_id?s.createElement("span",{className:"cursor-pointer  add_huiyuan_img1"}):3==e.mem_id||5==e.mem_id||6==e.mem_id?s.createElement("span",{className:"cursor-pointer  add_huiyuan_img2"}):4==e.mem_id?s.createElement("span",{className:"cursor-pointer  add_huiyuan_img3"}):s.createElement("span",{className:"cursor-pointer  add_huiyuan_img"})}})},1464:function(e,t,a){"use strict";e.exports.parseParamType=function(e){var t=0;return e&&("single_feed"==e?t=101:"headline"==e?t=102:"webview#/article/topic"==e?t=103:"webview#/search/everything"==e||"messages"==e?t=104:"feed_comment"==e?t=105:"feed"==e&&(t=106)),t},e.exports.parsesrcType=function(e){var t="";return 101==e?t='通过"专栏评论"找到你':102==e?t='通过"头条评论"找到你':103==e?t='通过"问答评论"找到你':104==e?t='通过"搜索"找到你':105==e?t='通过"动态评论"找到你':106==e?t='通过"动态"找到你':1==e&&(t='通过"动态"找到你'),t}},1465:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o,c,l=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),d=a(1),m=r(d),u=a(47),f=r(u),p=a(277),v=(c=o=function(e){function t(){var e,a,r,n;s(this,t);for(var o=arguments.length,c=Array(o),l=0;l<o;l++)c[l]=arguments[l];return a=r=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.componentDidMount=function(){(0,p.pingback)("visit_history","uinfo_guide","show",r.context.auth_info)},r.renderNoVisitor=function(){return m.default.createElement("div",null,m.default.createElement("div",{className:"font-0 w-30 box-x-center m-t-lg m-b-20"},m.default.createElement("img",{className:"w-100",src:"/static/images/no_visitor.png"})),m.default.createElement("div",{className:"font-16 p-y-10"},"无访客~想吸引访客提升",m.default.createElement("span",{className:"text-orange-ff7200"},"5"),"倍人气？"),m.default.createElement("div",{className:"font-15 text-muted"},"快来完善资料，让同事/校友找到你",m.default.createElement("br",null),"，加倍提升职场影响力"),m.default.createElement("div",{className:"go_inform_btn m-t-lg m-x-auto",onClick:r.props.goCompleteClick,style:{width:310}},"去完善资料"))},r.renderVisitorBottomView=function(){return m.default.createElement("div",null,m.default.createElement("div",{className:"m-t-20"},m.default.createElement("span",{className:"visitor_number"},r.props.total+"位访客")),m.default.createElement("div",{className:"font-16 m-t-10"},"资料还差"+(100-r.props.mystatus.info_ratio)+"%，即可建立职场知名度"),m.default.createElement("div",{className:"font-17 text-muted p-b",ref:"lockText"},"完善后可解锁完整访客名单"),m.default.createElement("div",{className:"go_inform_btn m-t-20 m-x-auto",onClick:r.props.goCompleteClick,style:{width:310}},"去完善资料"))},r.clickLock=function(){var e=f.default.findDOMNode(r.refs.lockText);e.className.indexOf("lock_text_animation")<0&&(e.className+=" lock_text_animation"),setTimeout(function(){e.className=e.className.replace(" lock_text_animation","")},4600)},r.renderVisitor=function(){var e=[];return!r.props.docs||r.props.docs.length<=0?r.renderNoVisitor():(1==r.props.total&&r.props.docs.length>0?e.push(m.default.createElement("div",{className:"visitor_list"},m.default.createElement("div",{className:"visitor_item visitor_center"},m.default.createElement("img",{src:r.props.docs[0].card.avatar}),m.default.createElement("div",{className:"visitor_cover"}),m.default.createElement("div",{className:"visitor_lock"})))):2==r.props.total&&r.props.docs.length>=2?e.push(m.default.createElement("div",{className:"visitor_list"},m.default.createElement("div",{className:"visitor_item visitor_two_left",onClick:function(e){return r.clickLock()}},m.default.createElement("img",{src:r.props.docs[0].card.avatar}),m.default.createElement("div",{className:"visitor_cover"}),m.default.createElement("div",{className:"visitor_lock"})),m.default.createElement("div",{className:"visitor_item visitor_two_right",onClick:function(e){return r.clickLock()}},m.default.createElement("img",{src:r.props.docs[1].card.avatar}),m.default.createElement("div",{className:"visitor_cover"}),m.default.createElement("div",{className:"visitor_lock"})))):3==r.props.total&&r.props.docs.length>=3?e.push(m.default.createElement("div",{className:"visitor_list"},m.default.createElement("div",{className:"visitor_item visitor_center_left",onClick:function(e){return r.clickLock()}},m.default.createElement("img",{src:r.props.docs[2].card.avatar}),m.default.createElement("div",{className:"visitor_cover"})),m.default.createElement("div",{className:"visitor_item visitor_center_right"},m.default.createElement("img",{src:r.props.docs[1].card.avatar}),m.default.createElement("div",{className:"visitor_cover"})),m.default.createElement("div",{className:"visitor_item visitor_center"},m.default.createElement("img",{src:r.props.docs[0].card.avatar}),m.default.createElement("div",{className:"visitor_cover"}),m.default.createElement("div",{className:"visitor_lock"})))):4==r.props.total&&r.props.docs.length>=4?e.push(m.default.createElement("div",{className:"visitor_list"},m.default.createElement("div",{className:"visitor_item visitor_four_center_left",onClick:function(e){return r.clickLock()}},m.default.createElement("img",{src:r.props.docs[0].card.avatar}),m.default.createElement("div",{className:"visitor_cover"}),m.default.createElement("div",{className:"visitor_lock"})),m.default.createElement("div",{className:"visitor_item visitor_four_center_right",onClick:function(e){return r.clickLock()}},m.default.createElement("img",{src:r.props.docs[1].card.avatar}),m.default.createElement("div",{className:"visitor_cover"}),m.default.createElement("div",{className:"visitor_lock"})),m.default.createElement("div",{className:"visitor_item visitor_four_left"},m.default.createElement("img",{src:r.props.docs[2].card.avatar}),m.default.createElement("div",{className:"visitor_cover"})),m.default.createElement("div",{className:"visitor_item visitor_four_right"},m.default.createElement("img",{src:r.props.docs[3].card.avatar}),m.default.createElement("div",{className:"visitor_cover"})))):e.push(m.default.createElement("div",{className:"visitor_list"},m.default.createElement("div",{className:"visitor_item visitor_center",onClick:function(e){return r.clickLock()}},m.default.createElement("img",{src:r.props.docs[0].card.avatar}),m.default.createElement("div",{className:"visitor_cover"}),m.default.createElement("div",{className:"visitor_lock"})),m.default.createElement("div",{className:"visitor_item visitor_center_left"},m.default.createElement("img",{src:r.props.docs[1].card.avatar}),m.default.createElement("div",{className:"visitor_cover"})),m.default.createElement("div",{className:"visitor_item visitor_center_right"},m.default.createElement("img",{src:r.props.docs[2].card.avatar}),m.default.createElement("div",{className:"visitor_cover"})),m.default.createElement("div",{className:"visitor_item visitor_left"},m.default.createElement("img",{src:r.props.docs[3].card.avatar}),m.default.createElement("div",{className:"visitor_cover"})),m.default.createElement("div",{className:"visitor_item visitor_right"},m.default.createElement("img",{src:r.props.docs[4].card.avatar}),m.default.createElement("div",{className:"visitor_cover"})))),e.push(r.renderVisitorBottomView()),e)},n=a,i(r,n)}return n(t,e),l(t,[{key:"render",value:function(){return m.default.createElement("div",{className:"text-center p-t-10"},this.props.total>0?this.renderVisitor():this.renderNoVisitor())}}]),t}(m.default.Component),o.contextTypes={auth_info:m.default.PropTypes.object},c);t.default=e.exports=v},777:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o,c,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},d=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),m=a(15),u=r(m),f=a(75),p=a(981),v=r(p),_=a(1),h=r(_),E=a(1463),y=r(E),g=a(1012),N=(r(g),a(989)),b=(r(N),a(1465)),k=r(b),x=a(165),w=r(x),C=a(50),T=r(C),j=a(113),O=a(17),P=r(O),D=a(78),M=r(D),F=a(164),S=a(46),B=r(S),L=a(277),A=a(982);t.default=e.exports=(c=o=function(e){function t(){var e,a,r,n;s(this,t);for(var o=arguments.length,c=Array(o),d=0;d<o;d++)c[d]=arguments[d];return a=r=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.state={isGoToEdit:!1},r.loadMore=function(){var e=r.props,t=e.docs,a=e.cursor,s=r.context.auth_info,i="/contact/visit_history?"+u.default.stringify(l({jsononly:1,visit_time:t[t.length-1].visit_time},s));r.refs.loader.bindRequest(function(){return fetch(i,{credentials:"same-origin"}).then(f.parse_online_json).then(function(e){a.select("more").set(e.data.more),a.select("docs").concat(e.data.docs)})})},r.reloadData=function(e){1==JSON.parse(e).status&&1!=r.props.mystatus.status?(0,F.refreshPageSilent)():1==r.state.isGoToEdit&&1!=r.props.mystatus.status&&(0,F.refreshPageSilent)(),r.setState({isGoToEdit:!1})},r.completeInfo=function(){r.setState({isGoToEdit:!0}),(0,L.pingback)("visit_history","uinfo_guide","click",r.context.auth_info),(0,M.default)(r.props.mycard.encode_mmid||r.props.mycard.mmid,r.context,{edit_mode:1,from:"visit_history"},"编辑资料")},r.acceptAddFriend=function(e,t){(0,F.acceptFriend)(e,1,r.context.fconf,r.context.auth_info,"visit_history").then(function(a){r.props.docs.map(function(a,s){a.card.mmid==e&&(r.props.cursor.select("docs",s,"card","dist").set(1),"number"==typeof t&&r.props.cursor.select("docs",s,"card","lv").set(t))})})},r.getDocCustor=function(e){for(var t in r.props.docs){if(r.props.docs[t].card.mmid==e)return r.props.cursor.select("docs",t)}},r.gotoAD=function(e){var t=r.props.ad_info;t&&t.vh_adv_url&&(0,B.default)(t.vh_adv_url,"","fetch")},r.renderAD=function(){var e=r.props.ad_info;if(e&&e.vh_adv_img)return h.default.createElement("div",null,h.default.createElement("img",{src:e.vh_adv_img,style:{maxWidth:"100%"},onClick:r.gotoAD}))},r.rankCenter=function(){var e=r.props.mycard.encode_mmid?r.props.mycard.encode_mmid:r.props.mycard.mmid;(0,B.default)("/contact/rank_detail?u2="+e,r.props.mycard.name+"的行业影响力","fetch")},r.memberCenter=function(e){e&&e.stopPropagation(),(0,T.default)("/uh_memlist?tpl=show&fr=visit_history","会员中心")},r.memberCenterTest=function(e){e&&e.stopPropagation(),(0,T.default)("/uh_memlist?tpl=show&fr=visit_history_2","会员中心")},n=a,i(r,n)}return n(t,e),d(t,[{key:"renderEmptyView",value:function(e,t,a,r){return h.default.createElement("div",{className:e?"empty-view imacss imacss-loading":"empty-view2"},h.default.createElement("div",{className:"text-muted"},t),h.default.createElement("div",{className:"text-muted"},a),h.default.createElement("div",{className:"btn btn-large btn-primary m-t",onClick:this.completeInfo},r))}},{key:"componentDidMount",value:function(){document.body.style.background="#f2f6f7",(0,j.bindBroadcast)("User_Info_Changed",this.reloadData)}},{key:"componentWillUnmount",value:function(){(0,j.unbindBroadcast)("User_Info_Changed",this.reloadData)}},{key:"renderNoStatus",value:function(e){var t=this,a=[];return P.default.map(e,function(e){a.push(h.default.createElement(y.default,{key:e.id,card:e,mycard:t.props.mycard}))}),this.props.total>0&&(a.push(h.default.createElement("div",{style:{textAlign:"center"},className:"borderBottom p-y-10",onClick:this.completeInfo},h.default.createElement("span",{className:"visit-history-tips text-muted"},"查看",h.default.createElement("span",{className:"text-primary"},"全部",this.props.total,"位"),"访客"))),a.push(this.renderEmptyView(!1,"资料还差"+(100-this.props.mystatus.info_ratio)+"%，即可建立职场知名度","完善后开启访客功能","完善资料"))),a}},{key:"renderComplete",value:function(e,t){var a=this,r=this.props,s=r.more,i=r.cursor,n=(r.idx,this.context.req),o=n.query.count||0,c=0,l=this.props.mycard;l&&1!=l.mem_st&&(c=1),1==c&&(s=0);return h.default.createElement("div",null,this.renderAD(),h.default.createElement(A,{loadMore:this.loadMore,hasMore:s>0,loader:h.default.createElement(w.default,{ref:"loader",reload:this.loadMore,cursor:i.select("loading_status")})},h.default.createElement("div",{className:"panel panel-default white-bg"},h.default.createElement("ul",{className:"list-group"},t.map(function(e){return h.default.createElement(y.default,{key:e.id,cursor:a.getDocCustor(e.id),card:e,mycard:a.props.mycard,acceptFriend:a.acceptAddFriend})}),o>0&&t.length>0&&o==t.length&&e.length>0&&h.default.createElement("div",{className:"middleLineBox text-center"},h.default.createElement("div",{className:"middleLine"}),h.default.createElement("div",{className:"middleLineTxt"},"上次你看到这里啦")),e.map(function(e){return h.default.createElement(y.default,{key:e.id,cursor:a.getDocCustor(e.id),card:e,mycard:a.props.mycard,acceptFriend:a.acceptAddFriend})}))),1==c&&h.default.createElement("div",{className:"mem_visitors"},h.default.createElement("img",{src:"/static/images/img_mem_visitors_2.png"}),h.default.createElement("div",{className:"m_v_message"},"开通会员，查看全部对你感兴趣的人"),h.default.createElement("div",{className:"m_v_btn",onClick:this.memberCenterTest},"立即开通"),h.default.createElement("div",{className:"m_v_btm"}))))}},{key:"renderRankHistory",value:function(){if(this.props.rank_history_day){var e=this.props.rank_history_day.cnt||0,t=0==this.props.mycard.mem_st||this.props.mycard.mem_id&&this.props.mycard.mem_id<=2;return h.default.createElement("div",{className:"visitor_rank",onClick:this.rankCenter},h.default.createElement("div",{className:"p-x p-y-20"+(t?" border-bottom-e0":"")},h.default.createElement("div",{className:"media-left font-0 media-middle"},h.default.createElement("img",{className:"avatar-52",src:"/static/images/paihang2.png"})),h.default.createElement("div",{className:"media-body media-middle"},h.default.createElement("div",{className:"font-16"},"行业影响力 ",parseInt(this.props.mystatus.rank)),h.default.createElement("div",{className:"font-13 text-muted m-t-5"},"今日",h.default.createElement("span",{className:"text-orange-hl"},e),"个访客",e>0&&h.default.createElement("span",null,"，影响力",h.default.createElement("span",{className:"text-orange-hl"},"+",this.props.rank_history_day.rank.toFixed(2))))),h.default.createElement("div",{className:"media-right p-l-0 media-middle"},h.default.createElement("span",{className:"arrow_light"}))),t&&h.default.createElement("div",{className:"font-15 text-muted p-y-12 p-x",onClick:this.memberCenter},h.default.createElement("span",{className:"visitor_rank_btn fr"},"马上提升"),h.default.createElement("div",{className:"o-hidden"},h.default.createElement("span",{className:"visitor_gift_icon media-middle m-r-5"}),h.default.createElement("span",{className:"d-i-b media-middle"},"提升影响力，让你人气更旺!"))))}}},{key:"render",value:function(){var e=this.props.docs;e=P.default.uniq(e,function(e){return e.id});var t=this.context.req;if(1==this.props.mystatus.status){var a=t.query.count||0,r=P.default.first(e,a);e=P.default.rest(e,a)}return h.default.createElement("div",null,this.renderRankHistory(),h.default.createElement(v.default,{title:"最近访客"}),1==this.props.mystatus.status&&this.renderComplete(e,r),1!=this.props.mystatus.status&&h.default.createElement(k.default,{mystatus:this.props.mystatus,total:this.props.total,docs:e,goCompleteClick:this.completeInfo}))}}]),t}(h.default.Component),o.contextTypes={auth_info:h.default.PropTypes.object,req:h.default.PropTypes.object,fconf:h.default.PropTypes.object},c)}});